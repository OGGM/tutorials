
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Merge, analyse and visualize OGGM GCM runs &#8212; OGGM tutorials</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Small overview of HoloViz capability of data exploration" href="../others/holoviz_intro.html" />
    <link rel="prev" title="Ingest gridded products such as ice velocity into OGGM" href="ingest_gridded_data_on_flowlines.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-106829797-2', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">OGGM tutorials</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../welcome.html">
                    Welcome to the OGGM tutorials!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  10 minutes tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../10minutes/preprocessed_directories.html">
   10 minutes to… a preprocessed directory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10minutes/run_with_gcm.html">
   10 minutes to… a glacier change projection with GCM data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10minutes/machine_learning.html">
   A toy statistical model of ice thickness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10minutes/elevation_bands_vs_centerlines.html">
   10 minutes to… understand the differences between “elevation band” and “centerline” flowlines in OGGM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10minutes/dynamical_spinup.html">
   10 minutes to… understand the new dynamical spinup in OGGM v1.6
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Beginner tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner/working_with_rgi.html">
   Working with the RGI files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner/full_prepro_workflow.html">
   What’s in my preprocessed directories? A full OGGM workflow, step by step
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner/store_and_compress_glacierdirs.html">
   Storing glacier directories for later use
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner/plot_mass_balance.html">
   Plotting the OGGM surface mass-balance, the ELA and AAR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner/deal_with_errors.html">
   Dealing with errors after a run
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner/inversion.html">
   Ice thickness inversion
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner/hydrological_output.html">
   Hydrological mass-balance output
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../beginner/oggm_shop.html">
   OGGM-Shop and Glacier Directories in OGGM
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Advanced tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="preprocessing_errors.html">
   Error analysis of the global pre-processing workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="run_with_a_spinup_and_gcm_data.html">
   Run with a spinup and GCM data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dynamical_spinup.html">
   Dynamic spinup and dynamic
   <span class="math notranslate nohighlight">
    \(\mu^*\)
   </span>
   calibration for past simulations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dem_sources.html">
   Create local topography maps from different DEM sources with OGGM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="use_your_own_inventory.html">
   Using your our own glacier inventory with OGGM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="centerlines_to_shape.html">
   Compute smoother centerlines for shapefile output
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="massbalance_calibration.html">
   A quick look into different mass-balance calibration options
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="where_are_the_flowlines.html">
   OGGM flowlines: where are they?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ingest_gridded_data_on_flowlines.html">
   Ingest gridded products such as ice velocity into OGGM
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Merge, analyse and visualize OGGM GCM runs
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Related to OGGM
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../others/holoviz_intro.html">
   Small overview of HoloViz capability of data exploration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../others/dem_comparison.html">
   Compare different DEMs for individual glaciers
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  In (re-)construction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../construction/inversion_with_frontal_ablation.html">
   Ice thickness inversion with frontal ablation: a case study
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../construction/kcalving_parameterization.html">
   The Oerlemans &amp; Nick frontal ablation parameterization in OGGM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../construction/merging_glaciers.html">
   Merging glaciers for past climate simulations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../construction/area_length_filter.html">
   Filter the glacier length and area time series
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/OGGM/binder/stable?urlpath=git-pull%3Frepo=https://github.com/OGGM/tutorials%26urlpath%3Dlab%252Ftree%252Ftutorials/./notebooks/advanced/merge_gcm_runs_and_visualize.ipynb%26branch%3Dmaster"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://hub.oggm.org/hub/user-redirect/git-pull?repo=https%3A//github.com/OGGM/tutorials&urlpath=lab/tree/tutorials/./notebooks/advanced/merge_gcm_runs_and_visualize.ipynb&branch=master"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/OGGM/tutorials"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/OGGM/tutorials/issues/new?title=Issue%20on%20page%20%2Fnotebooks/advanced/merge_gcm_runs_and_visualize.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/OGGM/tutorials/edit/master/./notebooks/advanced/merge_gcm_runs_and_visualize.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/advanced/merge_gcm_runs_and_visualize.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gcm-projection-runs">
   GCM projection runs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-processed-directories">
     Pre-processed directories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-and-process-gcm-data">
     Download and process GCM data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#actual-projection-runs">
     Actual projection Runs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#merge-datasets-together">
   Merge datasets together
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-new-coordinates">
     Add new coordinates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#actual-merging">
     Actual merging
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-regional-values">
   Calculate regional values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualisation-with-matplotlib-or-seaborn">
   Visualisation with matplotlib or seaborn
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#interactive-visualisation-with-holoviews-and-panel">
   Interactive visualisation with HoloViews and Panel
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-single-mean-curve-with-std-area">
     Create single mean curve with std area
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overlay-different-scenarios">
     Overlay different scenarios
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-different-variables-in-one-figure-and-save-as-html-file">
     Show different variables in one figure and save as html file
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-s-next">
   What’s next?
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Merge, analyse and visualize OGGM GCM runs</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#gcm-projection-runs">
   GCM projection runs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pre-processed-directories">
     Pre-processed directories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-and-process-gcm-data">
     Download and process GCM data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#actual-projection-runs">
     Actual projection Runs
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#merge-datasets-together">
   Merge datasets together
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-new-coordinates">
     Add new coordinates
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#actual-merging">
     Actual merging
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-regional-values">
   Calculate regional values
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualisation-with-matplotlib-or-seaborn">
   Visualisation with matplotlib or seaborn
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#interactive-visualisation-with-holoviews-and-panel">
   Interactive visualisation with HoloViews and Panel
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#create-single-mean-curve-with-std-area">
     Create single mean curve with std area
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#overlay-different-scenarios">
     Overlay different scenarios
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#show-different-variables-in-one-figure-and-save-as-html-file">
     Show different variables in one figure and save as html file
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#what-s-next">
   What’s next?
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="merge-analyse-and-visualize-oggm-gcm-runs">
<h1>Merge, analyse and visualize OGGM GCM runs<a class="headerlink" href="#merge-analyse-and-visualize-oggm-gcm-runs" title="Permalink to this headline">#</a></h1>
<p>In this notebook we want to show:</p>
<ul class="simple">
<li><p>How to merge the output of different OGGM GCM projections into one dataset</p></li>
<li><p>How to calculate regional values (e.g. volume) using the merged dataset</p></li>
<li><p>How to use matplotlib or <a class="reference external" href="https://seaborn.pydata.org/index.html">seaborn</a> to visualize the projections and plot different statistical estimates (median, interquartile range, mean, std, …)</p></li>
<li><p>How to use <a class="reference external" href="https://holoviews.org/">HoloViews</a> and <a class="reference external" href="https://panel.holoviz.org/">Panel</a> to visualize the outcome. This part uses advanced plotting capabilities which are not necessary to understand the rest of the notebook.</p></li>
</ul>
<p>This notebook is intended to explain the postprocessing steps, rather than the OGGM workflow itself. Therefore some code (especially conducting the GCM projection runs) does not have many explanations. If you are more interested in these steps you should check out the notebook <span class="xref myst">Run OGGM with GCM data</span>.</p>
<section id="gcm-projection-runs">
<h2>GCM projection runs<a class="headerlink" href="#gcm-projection-runs" title="Permalink to this headline">#</a></h2>
<p>The first step is to conduct the GCM projection runs. We choose two different glaciers by their rgi_ids and conduct the GCM projections. Again if you do not understand all of the following code you should check out the <span class="xref myst">Run OGGM with GCM data</span> notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Libs</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">gmtime</span><span class="p">,</span> <span class="n">strftime</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Locals</span>
<span class="kn">from</span> <span class="nn">oggm</span> <span class="kn">import</span> <span class="n">utils</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">tasks</span>
<span class="kn">import</span> <span class="nn">oggm.cfg</span> <span class="k">as</span> <span class="nn">cfg</span>
<span class="kn">from</span> <span class="nn">oggm.shop</span> <span class="kn">import</span> <span class="n">gcm_climate</span>
</pre></div>
</div>
</div>
</div>
<section id="pre-processed-directories">
<h3>Pre-processed directories<a class="headerlink" href="#pre-processed-directories" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize OGGM and set up the default run parameters</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">logging_level</span><span class="o">=</span><span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>

<span class="c1"># change border around the individual glaciers</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;border&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span>

<span class="c1"># Use Multiprocessing</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;use_multiprocessing&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># For hydro output</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;store_model_geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Local working directory (where OGGM will write its output)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s1">&#39;working_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(</span><span class="s1">&#39;OGGM_merge_gcm_runs&#39;</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># RGI glaciers: Ngojumba and Khumbu</span>
<span class="n">rgi_ids</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_rgi_glacier_entities</span><span class="p">([</span><span class="s1">&#39;RGI60-15.03473&#39;</span><span class="p">,</span> <span class="s1">&#39;RGI60-15.03733&#39;</span><span class="p">])</span>

<span class="c1"># Go - get the pre-processed glacier directories</span>
<span class="c1"># in OGGM v1.6 you have to explicitly indicate the url from where you want to start from</span>
<span class="c1"># we will use here the elevation band flowlines which are much simpler than the centerlines</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/&#39;</span>
            <span class="s1">&#39;L3-L5_files/2023.1/elev_bands/W5E5/&#39;</span><span class="p">)</span>
<span class="n">gdirs</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgi_ids</span><span class="p">,</span> <span class="n">from_prepro_level</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                          <span class="n">prepro_base_url</span><span class="o">=</span><span class="n">base_url</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-03-09 11:30:17: oggm.cfg: Reading default parameters from the OGGM `params.cfg` configuration file.
2023-03-09 11:30:17: oggm.cfg: Multiprocessing switched OFF according to the parameter file.
2023-03-09 11:30:17: oggm.cfg: Multiprocessing: using all available processors (N=2)
2023-03-09 11:30:17: oggm.cfg: Multiprocessing switched ON after user settings.
2023-03-09 11:30:17: oggm.cfg: PARAMS[&#39;store_model_geometry&#39;] changed from `False` to `True`.
2023-03-09 11:30:25: oggm.workflow: init_glacier_directories from prepro level 5 on 2 glaciers.
2023-03-09 11:30:25: oggm.workflow: Execute entity tasks [gdir_from_prepro] on 2 glaciers
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-and-process-gcm-data">
<h3>Download and process GCM data<a class="headerlink" href="#download-and-process-gcm-data" title="Permalink to this headline">#</a></h3>
<p>We prepared for you two options:</p>
<ul class="simple">
<li><p>You can either use the ISIMIP3b files that are bias-corrected CMIP6 GCMs</p></li>
<li><p>or use directly CMIP5 (differences explained shortly in <span class="xref myst">run_with_gcm</span>).
We will use here per default ISIMIP3b, because then you need to download less data.</p></li>
</ul>
<p>The subsequent postprocessing and plotting code works for both options. If you want to do the visualization with Holoviews, it only works with <code class="docutils literal notranslate"><span class="pre">option='CMIP5</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">option</span> <span class="o">=</span> <span class="s1">&#39;isimip3b_CMIP6&#39;</span>
<span class="c1"># option = &#39;CMIP5&#39;    ## Attention: This takes quite long and needs to download much more data </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;isimip3b_CMIP6&#39;</span><span class="p">:</span>
    <span class="n">all_GCM</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gfdl-esm4_r1i1p1f1&#39;</span><span class="p">,</span> <span class="s1">&#39;ipsl-cm6a-lr_r1i1p1f1&#39;</span><span class="p">,</span>
               <span class="s1">&#39;mpi-esm1-2-hr_r1i1p1f1&#39;</span><span class="p">,</span>
               <span class="s1">&#39;mri-esm2-0_r1i1p1f1&#39;</span><span class="p">,</span> <span class="s1">&#39;ukesm1-0-ll_r1i1p1f2&#39;</span><span class="p">]</span>

    <span class="c1"># define the SSP scenarios</span>
    <span class="n">all_scenario</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ssp126&#39;</span><span class="p">,</span> <span class="s1">&#39;ssp370&#39;</span><span class="p">,</span> <span class="s1">&#39;ssp585&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">GCM</span> <span class="ow">in</span> <span class="n">all_GCM</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ssp</span> <span class="ow">in</span> <span class="n">all_scenario</span><span class="p">:</span>
            <span class="c1"># Download and process them:</span>
            <span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">gcm_climate</span><span class="o">.</span><span class="n">process_monthly_isimip_data</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">,</span> 
                                         <span class="n">ssp</span> <span class="o">=</span> <span class="n">ssp</span><span class="p">,</span>
                                         <span class="c1"># gcm ensemble -&gt; you can choose another one</span>
                                         <span class="n">member</span><span class="o">=</span><span class="n">GCM</span><span class="p">,</span>
                                         <span class="c1"># recognize the climate file for later</span>
                                         <span class="n">output_filesuffix</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">GCM</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">ssp</span><span class="si">}</span><span class="s1">&#39;</span>
                                         <span class="p">);</span>
<span class="k">elif</span> <span class="n">option</span><span class="o">==</span><span class="s1">&#39;CMIP5&#39;</span><span class="p">:</span>
    <span class="c1"># define the GCM models you want to use</span>
    <span class="n">all_GCM</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CCSM4&#39;</span><span class="p">,</span>
               <span class="s1">&#39;CNRM-CM5&#39;</span><span class="p">,</span>
               <span class="s1">&#39;CSIRO-Mk3-6-0&#39;</span><span class="p">,</span>
              <span class="p">]</span>

    <span class="c1"># define the rcp scenarios to use</span>
    <span class="n">all_scenario</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rcp26&#39;</span><span class="p">,</span>
                   <span class="c1">#&#39;rcp45&#39;,# let&#39;s only take three scenarios, that is faster</span>
                   <span class="s1">&#39;rcp60&#39;</span><span class="p">,</span> 
                   <span class="s1">&#39;rcp85&#39;</span><span class="p">]</span>

    <span class="c1"># download locations for precipitation and temperature</span>
    <span class="n">bp</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/cmip5-ng/pr/pr_mon_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_r1i1p1_g025.nc&#39;</span>
    <span class="n">bt</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/cmip5-ng/tas/tas_mon_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_r1i1p1_g025.nc&#39;</span>

    <span class="k">for</span> <span class="n">GCM</span> <span class="ow">in</span> <span class="n">all_GCM</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">rcp</span> <span class="ow">in</span> <span class="n">all_scenario</span><span class="p">:</span>
            <span class="c1"># Download the files</span>
            <span class="n">ft</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">file_downloader</span><span class="p">(</span><span class="n">bt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GCM</span><span class="p">,</span> <span class="n">rcp</span><span class="p">))</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">file_downloader</span><span class="p">(</span><span class="n">bp</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GCM</span><span class="p">,</span> <span class="n">rcp</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># bias correct them</span>
                <span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">gcm_climate</span><span class="o">.</span><span class="n">process_cmip_data</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">,</span> 
                                             <span class="n">filesuffix</span><span class="o">=</span><span class="s1">&#39;_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GCM</span><span class="p">,</span> <span class="n">rcp</span><span class="p">),</span>  <span class="c1"># recognize the climate file for later</span>
                                             <span class="n">fpath_temp</span><span class="o">=</span><span class="n">ft</span><span class="p">,</span>  <span class="c1"># temperature projections</span>
                                             <span class="n">fpath_precip</span><span class="o">=</span><span class="n">fp</span><span class="p">,</span>  <span class="c1"># precip projections</span>
                                             <span class="p">);</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="c1"># if a certain scenario is not available for a GCM we land here</span>
                <span class="c1"># and we inidcate this by printing a message so the user knows</span>
                <span class="c1"># this scenario is missing</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No &#39;</span> <span class="o">+</span> <span class="n">GCM</span> <span class="o">+</span><span class="s1">&#39; run with scenario &#39;</span> <span class="o">+</span> <span class="n">rcp</span> <span class="o">+</span> <span class="s1">&#39; available!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-03-09 11:30:26: oggm.workflow: Execute entity tasks [process_monthly_isimip_data] on 2 glaciers
2023-03-09 11:30:36: oggm.workflow: Execute entity tasks [process_monthly_isimip_data] on 2 glaciers
2023-03-09 11:30:40: oggm.workflow: Execute entity tasks [process_monthly_isimip_data] on 2 glaciers
2023-03-09 11:30:45: oggm.workflow: Execute entity tasks [process_monthly_isimip_data] on 2 glaciers
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RemoteTraceback</span><span class="g g-Whitespace">                           </span>Traceback (most recent call last)
<span class="ne">Remote</span>Traceback: 
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/file_manager.py&quot;, line 210, in _acquire_with_cache_info</span>
<span class="sd">    file = self._cache[self._key]</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/lru_cache.py&quot;, line 56, in __getitem__</span>
<span class="sd">    value = self._cache[key]</span>
<span class="ne">KeyError</span>: [&lt;class &#39;netCDF4._netCDF4.Dataset&#39;&gt;, (&#39;/github/home/OGGM/download_cache/cluster.klima.uni-bremen.de/~oggm/cmip6/isimip3b/flat/monthly/ipsl-cm6a-lr_r1i1p1f1_w5e5_historical_prAdjust_global_monthly_flat_glaciers.nc&#39;,), &#39;r&#39;, ((&#39;clobber&#39;, True), (&#39;diskless&#39;, False), (&#39;format&#39;, &#39;NETCDF4&#39;), (&#39;persist&#39;, False)), &#39;4b057c62-3461-487f-b513-38d92aaa1fbf&#39;]

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/multiprocessing/pool.py&quot;, line 125, in worker</span>
<span class="sd">    result = (True, func(*args, **kwds))</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/multiprocessing/pool.py&quot;, line 48, in mapstar</span>
<span class="sd">    return list(map(*args))</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/oggm/workflow.py&quot;, line 108, in __call__</span>
<span class="sd">    res = self._call_internal(func, arg, kwargs)</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/oggm/workflow.py&quot;, line 102, in _call_internal</span>
<span class="sd">    return call_func(gdir, **kwargs)</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/oggm/utils/_workflow.py&quot;, line 491, in _entity_task</span>
<span class="sd">    out = task_func(gdir, **kwargs)</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/oggm/shop/gcm_climate.py&quot;, line 269, in process_monthly_isimip_data</span>
<span class="sd">    with xr.open_dataset(fpath_precip_h, use_cftime=True) as precipds_hist, \</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/api.py&quot;, line 526, in open_dataset</span>
<span class="sd">    backend_ds = backend.open_dataset(</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py&quot;, line 577, in open_dataset</span>
<span class="sd">    store = NetCDF4DataStore.open(</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py&quot;, line 382, in open</span>
<span class="sd">    return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py&quot;, line 329, in __init__</span>
<span class="sd">    self.format = self.ds.data_model</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py&quot;, line 391, in ds</span>
<span class="sd">    return self._acquire()</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py&quot;, line 385, in _acquire</span>
<span class="sd">    with self._manager.acquire_context(needs_lock) as root:</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/contextlib.py&quot;, line 135, in __enter__</span>
<span class="sd">    return next(self.gen)</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/file_manager.py&quot;, line 198, in acquire_context</span>
<span class="sd">    file, cached = self._acquire_with_cache_info(needs_lock)</span>
<span class="sd">  File &quot;/usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/file_manager.py&quot;, line 216, in _acquire_with_cache_info</span>
<span class="sd">    file = self._opener(*self._args, **kwargs)</span>
<span class="sd">  File &quot;src/netCDF4/_netCDF4.pyx&quot;, line 2449, in netCDF4._netCDF4.Dataset.__init__</span>
<span class="sd">  File &quot;src/netCDF4/_netCDF4.pyx&quot;, line 2012, in netCDF4._netCDF4._ensure_nc_success</span>
<span class="ne">OSError</span>: [Errno -101] NetCDF: HDF error: &#39;/github/home/OGGM/download_cache/cluster.klima.uni-bremen.de/~oggm/cmip6/isimip3b/flat/monthly/ipsl-cm6a-lr_r1i1p1f1_w5e5_historical_prAdjust_global_monthly_flat_glaciers.nc&#39;
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">OSError</span><span class="g g-Whitespace">                                   </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">12</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="k">for</span> <span class="n">GCM</span> <span class="ow">in</span> <span class="n">all_GCM</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>         <span class="k">for</span> <span class="n">ssp</span> <span class="ow">in</span> <span class="n">all_scenario</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>             <span class="c1"># Download and process them:</span>
<span class="ne">---&gt; </span><span class="mi">12</span>             <span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">gcm_climate</span><span class="o">.</span><span class="n">process_monthly_isimip_data</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">,</span> 
<span class="g g-Whitespace">     </span><span class="mi">13</span>                                          <span class="n">ssp</span> <span class="o">=</span> <span class="n">ssp</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>                                          <span class="c1"># gcm ensemble -&gt; you can choose another one</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>                                          <span class="n">member</span><span class="o">=</span><span class="n">GCM</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>                                          <span class="c1"># recognize the climate file for later</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>                                          <span class="n">output_filesuffix</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">GCM</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">ssp</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>                                          <span class="p">);</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="k">elif</span> <span class="n">option</span><span class="o">==</span><span class="s1">&#39;CMIP5&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="c1"># define the GCM models you want to use</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">all_GCM</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CCSM4&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>                <span class="s1">&#39;CNRM-CM5&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>                <span class="s1">&#39;CSIRO-Mk3-6-0&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span>               <span class="p">]</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/oggm/workflow.py:185,</span> in <span class="ni">execute_entity_task</span><span class="nt">(task, gdirs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">183</span> <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;use_multiprocessing&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">ng</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">184</span>     <span class="n">mppool</span> <span class="o">=</span> <span class="n">init_mp_pool</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">CONFIG_MODIFIED</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">185</span>     <span class="n">out</span> <span class="o">=</span> <span class="n">mppool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pc</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">186</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">187</span>     <span class="k">if</span> <span class="n">ng</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/multiprocessing/pool.py:367,</span> in <span class="ni">Pool.map</span><span class="nt">(self, func, iterable, chunksize)</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span> <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">363</span><span class="w">     </span><span class="sd">&#39;&#39;&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">364</span><span class="sd">     Apply `func` to each element in `iterable`, collecting the results</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span><span class="sd">     in a list that is returned.</span>
<span class="g g-Whitespace">    </span><span class="mi">366</span><span class="sd">     &#39;&#39;&#39;</span>
<span class="ne">--&gt; </span><span class="mi">367</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map_async</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">mapstar</span><span class="p">,</span> <span class="n">chunksize</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/multiprocessing/pool.py:774,</span> in <span class="ni">ApplyResult.get</span><span class="nt">(self, timeout)</span>
<span class="g g-Whitespace">    </span><span class="mi">772</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>
<span class="g g-Whitespace">    </span><span class="mi">773</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">774</span>     <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/multiprocessing/pool.py:125,</span> in <span class="ni">worker</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span> <span class="n">job</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span> <span class="o">=</span> <span class="n">task</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">125</span>     <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">127</span>     <span class="k">if</span> <span class="n">wrap_exception</span> <span class="ow">and</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_helper_reraises_exception</span><span class="p">:</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/multiprocessing/pool.py:48,</span> in <span class="ni">mapstar</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span> <span class="k">def</span> <span class="nf">mapstar</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">48</span>     <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/oggm/workflow.py:108,</span> in <span class="ni">__call__</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">106</span> <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_func</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">107</span>     <span class="n">func</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">func</span>
<span class="ne">--&gt; </span><span class="mi">108</span>     <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_internal</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">109</span> <span class="k">return</span> <span class="n">res</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/oggm/workflow.py:102,</span> in <span class="ni">_call_internal</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">99</span>     <span class="n">gdir</span><span class="p">,</span> <span class="n">gdir_kwargs</span> <span class="o">=</span> <span class="n">gdir</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span>     <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gdir_kwargs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">102</span> <span class="k">return</span> <span class="n">call_func</span><span class="p">(</span><span class="n">gdir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/oggm/utils/_workflow.py:491,</span> in <span class="ni">_entity_task</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">489</span>     <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;task_timeout&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">490</span> <span class="n">ex_t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">491</span> <span class="n">out</span> <span class="o">=</span> <span class="n">task_func</span><span class="p">(</span><span class="n">gdir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">492</span> <span class="n">ex_t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ex_t</span>
<span class="g g-Whitespace">    </span><span class="mi">493</span> <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;task_timeout&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/oggm/shop/gcm_climate.py:269,</span> in <span class="ni">process_monthly_isimip_data</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">265</span>     <span class="n">temp</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_a</span><span class="o">.</span><span class="n">latitude</span>
<span class="g g-Whitespace">    </span><span class="mi">267</span>     <span class="n">temp</span><span class="o">.</span><span class="n">lon</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">lon</span> <span class="k">if</span> <span class="n">temp</span><span class="o">.</span><span class="n">lon</span> <span class="o">&lt;=</span> <span class="mi">180</span> <span class="k">else</span> <span class="n">temp</span><span class="o">.</span><span class="n">lon</span> <span class="o">-</span> <span class="mi">360</span>
<span class="ne">--&gt; </span><span class="mi">269</span> <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fpath_precip_h</span><span class="p">,</span> <span class="n">use_cftime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">precipds_hist</span><span class="p">,</span> \
<span class="g g-Whitespace">    </span><span class="mi">270</span>         <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">fpath_precip</span><span class="p">,</span> <span class="n">use_cftime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">precipds_gcm</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">272</span>     <span class="n">c</span> <span class="o">=</span> <span class="p">((</span><span class="n">precipds_gcm</span><span class="o">.</span><span class="n">longitude</span> <span class="o">-</span> <span class="n">glon</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
<span class="g g-Whitespace">    </span><span class="mi">273</span>          <span class="p">(</span><span class="n">precipds_gcm</span><span class="o">.</span><span class="n">latitude</span> <span class="o">-</span> <span class="n">glat</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span>     <span class="n">precip_a_gcm</span> <span class="o">=</span> <span class="n">precipds_gcm</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">points</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/api.py:526,</span> in <span class="ni">open_dataset</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">514</span> <span class="n">decoders</span> <span class="o">=</span> <span class="n">_resolve_decoders_kwargs</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">515</span>     <span class="n">decode_cf</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">516</span>     <span class="n">open_backend_dataset_parameters</span><span class="o">=</span><span class="n">backend</span><span class="o">.</span><span class="n">open_dataset_parameters</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">522</span>     <span class="n">decode_coords</span><span class="o">=</span><span class="n">decode_coords</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">523</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">525</span> <span class="n">overwrite_encoded_chunks</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;overwrite_encoded_chunks&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">526</span> <span class="n">backend_ds</span> <span class="o">=</span> <span class="n">backend</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">527</span>     <span class="n">filename_or_obj</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">528</span>     <span class="n">drop_variables</span><span class="o">=</span><span class="n">drop_variables</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">529</span>     <span class="o">**</span><span class="n">decoders</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">530</span>     <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">531</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">532</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">_dataset_from_backend_dataset</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">533</span>     <span class="n">backend_ds</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">534</span>     <span class="n">filename_or_obj</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">542</span>     <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">543</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">544</span> <span class="k">return</span> <span class="n">ds</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py:577,</span> in <span class="ni">open_dataset</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">557</span> <span class="k">def</span> <span class="nf">open_dataset</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">558</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span>     <span class="n">filename_or_obj</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span>     <span class="n">autoclose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">575</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span>     <span class="n">filename_or_obj</span> <span class="o">=</span> <span class="n">_normalize_path</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">577</span>     <span class="n">store</span> <span class="o">=</span> <span class="n">NetCDF4DataStore</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">578</span>         <span class="n">filename_or_obj</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">579</span>         <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">580</span>         <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">581</span>         <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">582</span>         <span class="n">clobber</span><span class="o">=</span><span class="n">clobber</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">583</span>         <span class="n">diskless</span><span class="o">=</span><span class="n">diskless</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>         <span class="n">persist</span><span class="o">=</span><span class="n">persist</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span>         <span class="n">lock</span><span class="o">=</span><span class="n">lock</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">586</span>         <span class="n">autoclose</span><span class="o">=</span><span class="n">autoclose</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">589</span>     <span class="n">store_entrypoint</span> <span class="o">=</span> <span class="n">StoreBackendEntrypoint</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">590</span>     <span class="k">with</span> <span class="n">close_on_error</span><span class="p">(</span><span class="n">store</span><span class="p">):</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py:382,</span> in <span class="ni">open</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">376</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">377</span>     <span class="n">clobber</span><span class="o">=</span><span class="n">clobber</span><span class="p">,</span> <span class="n">diskless</span><span class="o">=</span><span class="n">diskless</span><span class="p">,</span> <span class="n">persist</span><span class="o">=</span><span class="n">persist</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span>
<span class="g g-Whitespace">    </span><span class="mi">378</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> <span class="n">manager</span> <span class="o">=</span> <span class="n">CachingFileManager</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span>     <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span>
<span class="g g-Whitespace">    </span><span class="mi">381</span> <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">382</span> <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">manager</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">group</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">lock</span><span class="o">=</span><span class="n">lock</span><span class="p">,</span> <span class="n">autoclose</span><span class="o">=</span><span class="n">autoclose</span><span class="p">)</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py:329,</span> in <span class="ni">__init__</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group</span> <span class="o">=</span> <span class="n">group</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="n">mode</span>
<span class="ne">--&gt; </span><span class="mi">329</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">data_model</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ds</span><span class="o">.</span><span class="n">filepath</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_remote</span> <span class="o">=</span> <span class="n">is_remote_uri</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">)</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py:391,</span> in <span class="ni">ds</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span> <span class="nd">@property</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span> <span class="k">def</span> <span class="nf">ds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">391</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquire</span><span class="p">()</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/netCDF4_.py:385,</span> in <span class="ni">_acquire</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span> <span class="k">def</span> <span class="nf">_acquire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">needs_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">385</span>     <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">acquire_context</span><span class="p">(</span><span class="n">needs_lock</span><span class="p">)</span> <span class="k">as</span> <span class="n">root</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span>         <span class="n">ds</span> <span class="o">=</span> <span class="n">_nc4_require_group</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">387</span>     <span class="k">return</span> <span class="n">ds</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/contextlib.py:135,</span> in <span class="ni">__enter__</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kwds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">135</span>     <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gen</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">136</span> <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;generator didn&#39;t yield&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/file_manager.py:198,</span> in <span class="ni">acquire_context</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">195</span> <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<span class="g g-Whitespace">    </span><span class="mi">196</span> <span class="k">def</span> <span class="nf">acquire_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">needs_lock</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">197</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Context manager for acquiring a file.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">198</span>     <span class="n">file</span><span class="p">,</span> <span class="n">cached</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_acquire_with_cache_info</span><span class="p">(</span><span class="n">needs_lock</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">199</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">200</span>         <span class="k">yield</span> <span class="n">file</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.10/lib/python3.10/site-packages/xarray/backends/file_manager.py:216,</span> in <span class="ni">_acquire_with_cache_info</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span>     <span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span>
<span class="ne">--&gt; </span><span class="mi">216</span> <span class="n">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_opener</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">217</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span>     <span class="c1"># ensure file doesn&#39;t get overridden when opened again</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span> <span class="o">=</span> <span class="s2">&quot;a&quot;</span>

<span class="nn">File src/netCDF4/_netCDF4.pyx:2449,</span> in <span class="ni">netCDF4._netCDF4.Dataset.__init__</span><span class="nt">()</span>

<span class="nn">File src/netCDF4/_netCDF4.pyx:2012,</span> in <span class="ni">netCDF4._netCDF4._ensure_nc_success</span><span class="nt">()</span>

<span class="ne">OSError</span>: [Errno -101] NetCDF: HDF error: &#39;/github/home/OGGM/download_cache/cluster.klima.uni-bremen.de/~oggm/cmip6/isimip3b/flat/monthly/ipsl-cm6a-lr_r1i1p1f1_w5e5_historical_prAdjust_global_monthly_flat_glaciers.nc&#39;
</pre></div>
</div>
</div>
</div>
<p>Here we defined, downloaded and processed all the GCM models and scenarios (either SSP or RCP) that we want to use. In case of CMIP5, you can get <a class="reference external" href="https://cluster.klima.uni-bremen.de/~oggm/cmip5-ng/gcm_table.html">here</a> an overview of all available options. As you see in the overview only for two of the three GCMs for CMIP5 the rcp60 Scenario is available! We deal with this issue by including a <code class="docutils literal notranslate"><span class="pre">try</span></code>/<code class="docutils literal notranslate"><span class="pre">except</span></code> in the code below.</p>
</section>
<section id="actual-projection-runs">
<h3>Actual projection Runs<a class="headerlink" href="#actual-projection-runs" title="Permalink to this headline">#</a></h3>
<p>Now we conduct the actual projection runs. Again handling the case that for a certain (GCM, SCENARIO) combination no data is available with a <code class="docutils literal notranslate"><span class="pre">try</span></code>/<code class="docutils literal notranslate"><span class="pre">except</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">GCM</span> <span class="ow">in</span> <span class="n">all_GCM</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">scen</span> <span class="ow">in</span> <span class="n">all_scenario</span><span class="p">:</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GCM</span><span class="p">,</span> <span class="n">scen</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># check if (GCM, scen) combination exists</span>
            <span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">run_with_hydro</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">,</span>
                                         <span class="n">run_task</span><span class="o">=</span><span class="n">tasks</span><span class="o">.</span><span class="n">run_from_climate_data</span><span class="p">,</span>
                                         <span class="n">ys</span><span class="o">=</span><span class="mi">2020</span><span class="p">,</span>  <span class="c1"># star year of our projection runs</span>
                                         <span class="n">climate_filename</span><span class="o">=</span><span class="s1">&#39;gcm_data&#39;</span><span class="p">,</span>  <span class="c1"># use gcm_data, not climate_historical</span>
                                         <span class="n">climate_input_filesuffix</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span>  <span class="c1"># use the chosen GCM and scenario</span>
                                         <span class="n">init_model_filesuffix</span><span class="o">=</span><span class="s1">&#39;_historical&#39;</span><span class="p">,</span>  <span class="c1"># this is important! Start from 2020 glacier</span>
                                         <span class="n">output_filesuffix</span><span class="o">=</span><span class="n">rid</span><span class="p">,</span>  <span class="c1"># the filesuffix of the resulting file, so we can find it later</span>
                                         <span class="n">store_monthly_hydro</span><span class="o">=</span><span class="kc">True</span>
                                        <span class="p">);</span>

        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="c1"># if a certain scenario is not available for a GCM we land here</span>
            <span class="c1"># and we inidcate this by printing a message so the user knows</span>
            <span class="c1"># this scenario is missing</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No &#39;</span> <span class="o">+</span> <span class="n">GCM</span> <span class="o">+</span><span class="s1">&#39; run with scenario &#39;</span> <span class="o">+</span> <span class="n">scen</span> <span class="o">+</span> <span class="s1">&#39; available!&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="merge-datasets-together">
<h2>Merge datasets together<a class="headerlink" href="#merge-datasets-together" title="Permalink to this headline">#</a></h2>
<p>Now that we have conducted the projection Runs we can start merging all outputs into one dataset. The individual files can be opened by providing the <code class="docutils literal notranslate"><span class="pre">output_filesuffix</span></code> of the projection runs as the <code class="docutils literal notranslate"><span class="pre">input_filesuffix</span></code>. Let us have a look at one resulting dataset!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_id</span>  <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">all_GCM</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">all_scenario</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compile_run_output</span><span class="p">(</span><span class="n">gdirs</span><span class="p">,</span> <span class="n">input_filesuffix</span><span class="o">=</span><span class="n">file_id</span><span class="p">)</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
</div>
<p>We see that as a result, we get a <a class="reference external" href="https://xarray.pydata.org/en/stable/generated/xarray.Dataset.html">xarray.Dataset</a>. We also see that this dataset has three dimensions <code class="docutils literal notranslate"><span class="pre">time</span></code>, <code class="docutils literal notranslate"><span class="pre">rgi_id</span></code> and <code class="docutils literal notranslate"><span class="pre">month_2d</span></code>. When we look at the <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">variables</span></code> (click to expand) we can see that for each of these variables a certain combination of the dimensions is given. For example, for the <code class="docutils literal notranslate"><span class="pre">volume</span></code> we see the dimensions <code class="docutils literal notranslate"><span class="pre">(time,</span> <span class="pre">rgi_id)</span></code> which indicates that the underlying data is separated by each year and each glacier. Let’s have a look at the volume in 2030 and 2040 at the glacier ‘RGI60-15.03473’ (Ngojumba):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2030</span><span class="p">,</span> <span class="mi">2040</span><span class="p">],</span> <span class="s1">&#39;rgi_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;RGI60-15.03473&#39;</span> <span class="p">]}]</span>
</pre></div>
</div>
</div>
</div>
<p>A more complete overview of how to access the data of xarray Dataset can be found <a class="reference external" href="https://xarray.pydata.org/en/stable/user-guide/indexing.html#dataset-indexing">here</a>.</p>
<p>This is quite useful, but unfortunately, we have one xarray Dataset for each (GCM, RCP) pair. For an easier calculation and comparison between different GCMs and Scenarios(SSPs or RCPs), it would be desirable to combine all individual Datasets into one Dataset with the additional dimensions <code class="docutils literal notranslate"><span class="pre">(GCM,</span> <span class="pre">SCENARIO)</span></code>. Fortunately, xarray provides different functions to merge Datasets (<a class="reference external" href="https://xarray.pydata.org/en/stable/user-guide/combining.html">here</a> you can find an Overview).</p>
<p>In our case, we want to merge all individual datasets with two additional coordinates <code class="docutils literal notranslate"><span class="pre">GCM</span></code> and <code class="docutils literal notranslate"><span class="pre">SCENARIO</span></code>. Additional coordinates can be added with the comment <code class="docutils literal notranslate"><span class="pre">.coords[]</span></code>, also you can include a description with <code class="docutils literal notranslate"><span class="pre">.coords[].attrs['description']</span></code>. For example, let us add <code class="docutils literal notranslate"><span class="pre">GCM</span></code> as a new coordinate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;GCM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_GCM</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;GCM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Global Circulation Model&#39;</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
</div>
<p>You can see that now <code class="docutils literal notranslate"><span class="pre">GCM</span></code> is added as Coordinate, but when you look at the Data variables you see that this new Coordinate is not used by any of them. So we must add this new Coordinate to the Data variables using the <code class="docutils literal notranslate"><span class="pre">.expand_dims()</span></code> comment:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="s1">&#39;GCM&#39;</span><span class="p">)</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
</div>
<p>Now we see that <code class="docutils literal notranslate"><span class="pre">GCM</span></code> was added to the Dimensions and all Data variables now use this new coordinate. The same can be done with <code class="docutils literal notranslate"><span class="pre">SCENARIO</span></code>. As a standalone, this is not very useful. But if we add these coordinates to all datasets, it becomes quite handy for merging. Therefore we now open all datasets and add to each one the two coordinates <code class="docutils literal notranslate"><span class="pre">GCM</span></code> and <code class="docutils literal notranslate"><span class="pre">SCENARIO</span></code>:</p>
<section id="add-new-coordinates">
<h3>Add new coordinates<a class="headerlink" href="#add-new-coordinates" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_all</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># in this array all datasets going to be stored with additional coordinates GCM and RCP</span>
<span class="n">creation_date</span> <span class="o">=</span> <span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">,</span> <span class="n">gmtime</span><span class="p">())</span>  <span class="c1"># here add the current time for info</span>
<span class="k">for</span> <span class="n">GCM</span> <span class="ow">in</span> <span class="n">all_GCM</span><span class="p">:</span>  <span class="c1"># loop through all GCMs</span>
    <span class="k">for</span> <span class="n">scen</span> <span class="ow">in</span> <span class="n">all_scenario</span><span class="p">:</span>  <span class="c1"># loop through all RCPs</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># check if GCM, RCP combination exists</span>
            <span class="n">rid</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">GCM</span><span class="p">,</span> <span class="n">scen</span><span class="p">)</span>  <span class="c1"># put together the same filesuffix which was used during the projection runs</span>

            <span class="n">ds_tmp</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">compile_run_output</span><span class="p">(</span><span class="n">gdirs</span><span class="p">,</span> <span class="n">input_filesuffix</span><span class="o">=</span><span class="n">rid</span><span class="p">)</span>  <span class="c1"># open one model run</span>

            <span class="n">ds_tmp</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;GCM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GCM</span>  <span class="c1"># add GCM as a coordinate</span>
            <span class="n">ds_tmp</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;GCM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;used Global circulation Model&#39;</span>  <span class="c1"># add a description for GCM</span>
            <span class="n">ds_tmp</span> <span class="o">=</span> <span class="n">ds_tmp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="s2">&quot;GCM&quot;</span><span class="p">)</span>  <span class="c1"># add GCM as a dimension to all Data variables</span>

            <span class="n">ds_tmp</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;SCENARIO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scen</span>  <span class="c1"># add scenario (ssp or rcp) as a coordinate</span>
            <span class="n">ds_tmp</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;SCENARIO&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;used scenario (SSP or RCP)&#39;</span>
            <span class="n">ds_tmp</span> <span class="o">=</span> <span class="n">ds_tmp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="s2">&quot;SCENARIO&quot;</span><span class="p">)</span>  <span class="c1"># add RCP as a dimension to all Data variables</span>

            <span class="n">ds_tmp</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;creation_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">creation_date</span>  <span class="c1"># also add todays date for info</span>
            <span class="n">ds_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_tmp</span><span class="p">)</span>  <span class="c1"># add the dataset with extra coordinates to our final ds_all array</span>

        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>  <span class="c1"># here we land if an error occured</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Found no valid glaciers!&#39;</span><span class="p">:</span>  <span class="c1"># This is the error message if the GCM, RCP combination does not exist</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No data for GCM </span><span class="si">{</span><span class="n">GCM</span><span class="si">}</span><span class="s1"> with SCENARIO </span><span class="si">{</span><span class="n">scen</span><span class="si">}</span><span class="s1"> found!&#39;</span><span class="p">)</span>  <span class="c1"># print a descriptive message</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>  <span class="c1"># if an other error occured we just raise it</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="actual-merging">
<h3>Actual merging<a class="headerlink" href="#actual-merging" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ds_all</span></code> now contains all outputs with the additionally added coordinates. Now we can merge them with the very convenient xarray function <code class="docutils literal notranslate"><span class="pre">xr.combine_by_coords()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_merged</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span><span class="n">ds_all</span><span class="p">,</span>
                                 <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>  <span class="c1"># define how the missing GCM, RCP combinations should be filled</span>
</pre></div>
</div>
</div>
</div>
<p>Great! You see that the result is one Dataset, but we still can identify the individual runs with the two additionally added Coordinates GCM and RCP. If you want to save this new Dataset for later analysis you can use for example <code class="docutils literal notranslate"><span class="pre">.to_netcdf()</span></code> (<a class="reference external" href="https://xarray.pydata.org/en/stable/user-guide/io.html">here</a> you can find an Overview of xarray writing options):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ds_merged</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="s1">&#39;merged_GCM_projections.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>And to open it again later and automatically close the file after reading you can use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;merged_GCM_projections.nc&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">ds_merged</span> <span class="o">=</span> <span class="n">ds</span>
</pre></div>
</div>
</section>
</section>
<section id="calculate-regional-values">
<h2>Calculate regional values<a class="headerlink" href="#calculate-regional-values" title="Permalink to this headline">#</a></h2>
<p>Now we have our merged dataset and we can start with the analysis. To do this xarray gives us a ton of different mathematical functions which can be used directly with our dataset. <a class="reference external" href="https://xarray.pydata.org/en/stable/user-guide/computation.html">Here</a> you can find a great overview of what is possible.</p>
<p>As an example, we could calculate the mean and std of the total regional glacier volume for different scenarios of our merged dataset. Here our added coordinates come in very handy. However, for a small amount of GCMs (for ISIMIP3b e.g. 5 GCMs), it is often better to compute instead more robust estimates, such as the median, the 25th and 75th percentile or the total range. We will show different options later:</p>
<p>Let us start by calculating the total “regional” glacier volume using <code class="docutils literal notranslate"><span class="pre">.sum()</span></code> (of course, here is is just the sum over two glaciers…):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_total_volume</span> <span class="o">=</span> <span class="n">ds_merged</span><span class="p">[</span><span class="s1">&#39;volume&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;rgi_id&#39;</span><span class="p">,</span>  <span class="c1"># over which dimension the sum should be taken, here we want to sum up over all glacier ids</span>
                                          <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># ignore nan values</span>
                                          <span class="c1"># important, we need values for every glacier (here 2) to do the sum</span>
                                          <span class="c1"># if some have NaN, the sum should also be NaN (if you don&#39;t set min_count, the sum will be 0, which is bad)</span>
                                          <span class="n">min_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_merged</span><span class="o">.</span><span class="n">rgi_id</span><span class="p">),</span> 
                                          <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># keep the variable descriptions                                                              </span>
</pre></div>
</div>
</div>
</div>
<p>For this calculation, we told xarray over which dimension we want to sum up <code class="docutils literal notranslate"><span class="pre">dim='rgi_id'</span></code> (all glaciers ), that missing values should be ignored <code class="docutils literal notranslate"><span class="pre">skipna=True</span></code> (as some GCM/RCP combinations are not available) and that the attributes (the description of the variables) should be preserved <code class="docutils literal notranslate"><span class="pre">keep_attrs=True</span></code>. You can see that the result has three dimensions left <code class="docutils literal notranslate"><span class="pre">(GCM,</span> <span class="pre">time,</span> <span class="pre">RCP)</span></code> and the dimension <code class="docutils literal notranslate"><span class="pre">rgi_id</span></code> disappeared as we have summed all values up along this dimension.</p>
<p>Likewise, we can now calculate for example the median of all GCM runs:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_total_volume_median</span> <span class="o">=</span> <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span>  <span class="c1"># over which dimension the median should be calculated</span>
                                            <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># ignore nan values</span>
                                            <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># keep all variable descriptions</span>
<span class="n">ds_total_volume_median</span>
</pre></div>
</div>
</div>
</div>
<p>And you see that now we are left with two dimensions <code class="docutils literal notranslate"><span class="pre">(SCENARIO,</span> <span class="pre">time)</span></code>. This means we have calculated the median total volume for all different scenarios (SSP or RCP) and along the projection period. The mean, standard deviation (std) or percentiles can be also calculated in the same way as the median. Again, bare in mind, that for small sample sizes of GCM ensembles (15), which is almost always the case, it is often much more robust to use median and the interquartile range or other percentile ranges.</p>
</section>
<section id="visualisation-with-matplotlib-or-seaborn">
<h2>Visualisation with matplotlib or seaborn<a class="headerlink" href="#visualisation-with-matplotlib-or-seaborn" title="Permalink to this headline">#</a></h2>
<p>We will first use matplotlib, where we need to estimate the statistical estimates ourselves. This is good to understand what we are doing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># estimate the minimum volume for each time step and scenario over the GCMs</span>
<span class="n">ds_total_volume_min</span> <span class="o">=</span> <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># estimate the 25th percentile volume for each time step and scenario over the GCMs</span>
<span class="n">ds_total_volume_p25</span> <span class="o">=</span> <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># estimate the 50th percentile volume for each time step and scenario over the GCMs</span>
<span class="n">ds_total_volume_p50</span> <span class="o">=</span> <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># this is the same as the median -&gt; Let&#39;s check</span>
<span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_allclose</span><span class="p">(</span><span class="n">ds_total_volume_median</span><span class="p">,</span><span class="n">ds_total_volume_p50</span><span class="p">)</span>
<span class="c1"># estimate the 75th percentile volume for each time step and scenario over the GCMs</span>
<span class="n">ds_total_volume_p75</span> <span class="o">=</span> <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># estimate the maximum volume for each time step and scenario over the GCMs</span>
<span class="n">ds_total_volume_max</span> <span class="o">=</span> <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Think twice if it is appropriate to compute a mean/std over your GCM sample, is it Gaussian distributed?</span>
<span class="c1"># Otherwise use instead median and percentiles or total range</span>
<span class="n">ds_total_volume_mean</span> <span class="o">=</span> <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                            <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_total_volume_std</span> <span class="o">=</span> <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                            <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;isimip3b_CMIP6&#39;</span><span class="p">:</span>
    <span class="n">color_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;ssp126&#39;</span><span class="p">:</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;ssp370&#39;</span><span class="p">:</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;ssp585&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">}</span>
<span class="k">elif</span> <span class="n">option</span> <span class="o">==</span> <span class="s1">&#39;CMIP5&#39;</span><span class="p">:</span>
    <span class="n">color_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;rcp26&#39;</span><span class="p">:</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;rcp60&#39;</span><span class="p">:</span><span class="s1">&#39;violet&#39;</span><span class="p">,</span> <span class="s1">&#39;rcp85&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">}</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> 
                        <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># we want to share the y axis betweeen the subplots</span>
                       <span class="p">)</span>
<span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">color_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="c1"># get amount of GCMs per Scenario to add it to the legend:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds_total_volume</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">GCM</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ds_total_volume_median</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">ds_total_volume_median</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span>  <span class="c1"># m3 -&gt; km3</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">scenario</span><span class="si">}</span><span class="s1">: n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> GCMs&#39;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color_dict</span><span class="p">[</span><span class="n">scenario</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ds_total_volume_median</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                        <span class="n">ds_total_volume_p25</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span>
                        <span class="n">ds_total_volume_p75</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_dict</span><span class="p">[</span><span class="n">scenario</span><span class="p">],</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;interquartile range</span><span class="se">\n</span><span class="s1">(75th-25th percentile)&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ds_total_volume_median</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                        <span class="n">ds_total_volume_min</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span>
                        <span class="n">ds_total_volume_max</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_dict</span><span class="p">[</span><span class="n">scenario</span><span class="p">],</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;total range&#39;</span><span class="p">)</span>


<span class="k">for</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">color_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ds_total_volume_mean</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                 <span class="n">ds_total_volume_mean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span>  <span class="c1"># m3 -&gt; km3</span>
                 <span class="n">color</span><span class="o">=</span><span class="n">color_dict</span><span class="p">[</span><span class="n">scenario</span><span class="p">],</span>
                 <span class="n">label</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ds_total_volume_mean</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                        <span class="n">ds_total_volume_mean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span> <span class="o">-</span> <span class="n">ds_total_volume_std</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span>
                        <span class="n">ds_total_volume_mean</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span> <span class="o">+</span> <span class="n">ds_total_volume_std</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color_dict</span><span class="p">[</span><span class="n">scenario</span><span class="p">],</span>
                       <span class="n">label</span><span class="o">=</span><span class="s1">&#39;standard deviation&#39;</span><span class="p">)</span>
    
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">leg1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">labels</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Scenario&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Volume (km$^3$)&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="n">handles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">handles</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">handles</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
                  <span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">,</span><span class="n">labels</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">labels</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">leg1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># we only want to have the legend for mean and std</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">labels</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">);</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>You have to choose which statistical estimate is best in your case. It is also a good possibility to just plot all the scenarios, and then to decide which statistical estimate describes best the spread in your case:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for example, if there are just 3 GCMs, maybe you can just show all of them?</span>
<span class="k">for</span> <span class="n">gcm</span> <span class="ow">in</span> <span class="n">all_GCM</span><span class="p">:</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ds_total_volume</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">SCENARIO</span><span class="o">=</span><span class="n">scenario</span><span class="p">,</span> <span class="n">GCM</span><span class="o">=</span><span class="n">gcm</span><span class="p">),</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You could create similar plots even easier with  <a class="reference external" href="https://seaborn.pydata.org/index.html">seaborn</a>, which has a lot of statistical estimation tools directly included (specifically in seaborn&gt;=v0.12). You can for example check out <a class="reference external" href="https://seaborn.pydata.org/tutorial/error_bars.html">this errorbar seaborn tutorial</a>. Note that the outcome can be slightly different even for the same statistical estimate as e.g. seaborn and xarray might use different methods to compute the same thing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span> 
<span class="c1"># this code might only work with seaborn v&gt;=0.12</span>
<span class="c1"># seaborn always likes to have pandas dataframes</span>
<span class="n">pd_total_volume</span> <span class="o">=</span> <span class="n">ds_total_volume</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="s1">&#39;volume_m3&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;volume_m3&#39;</span><span class="p">,</span>
             <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;SCENARIO&#39;</span><span class="p">,</span> <span class="c1"># these are the dimension for the different colors </span>
             <span class="n">estimator</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="c1"># here you could also choose the mean</span>
             <span class="n">data</span><span class="o">=</span><span class="n">pd_total_volume</span><span class="p">,</span>
             <span class="c1"># here you could also choose another percentile range</span>
             <span class="c1"># &quot;90&quot; means the range goes from the 5th to the 95th percentile</span>
             <span class="c1"># (50 would be the interquartile range, i.e., the same as two plots above)</span>
             <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;pi&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span> 
            <span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="interactive-visualisation-with-holoviews-and-panel">
<h2>Interactive visualisation with HoloViews and Panel<a class="headerlink" href="#interactive-visualisation-with-holoviews-and-panel" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>the following code only works if you install holoviews and panel</p></li>
</ul>
<p>We can also visualize the data using tools from the <a class="reference external" href="https://holoviz.org/">HoloViz</a> framework (namely <a class="reference external" href="https://holoviews.org/">HoloViews</a> and <a class="reference external" href="https://panel.holoviz.org/">Panel</a>). For an introduction to HoloViz, you can have a look at the <span class="xref myst">Small overview of HoloViz capability of data exploration</span> notebook.</p>
<p>This part of the code only works at the moment if you set
option=<code class="docutils literal notranslate"><span class="pre">CMIP5</span></code> when you preprocess the projection data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting</span>
<span class="kn">import</span> <span class="nn">holoviews</span> <span class="k">as</span> <span class="nn">hv</span>
<span class="kn">import</span> <span class="nn">panel</span> <span class="k">as</span> <span class="nn">pn</span>
<span class="n">hv</span><span class="o">.</span><span class="n">extension</span><span class="p">(</span><span class="s1">&#39;bokeh&#39;</span><span class="p">)</span>
<span class="n">pn</span><span class="o">.</span><span class="n">extension</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To make your life easier with Holoviews and Panel, you can define a small function that computes your estimates:</p>
<ul class="simple">
<li><p>In the following section, we only show mean and std, but this could be similar applied to the median and specific percentiles (which might be more robust in your use case :-) ). But just for showing how it works, it is fine to use here mean and std!</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_total_mean_and_std</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;rgi_id&#39;</span><span class="p">,</span>  <span class="c1"># first sum up over all glaciers</span>
                            <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="c1"># important, need values for every glacier</span>
                            <span class="n">min_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_merged</span><span class="o">.</span><span class="n">rgi_id</span><span class="p">),</span> 
                           <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span>  <span class="c1"># afterwards calculate the mean of all GCMs</span>
                                  <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                 <span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;rgi_id&#39;</span><span class="p">,</span>  <span class="c1"># first sum up over all glaciers </span>
                           <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">min_count</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_merged</span><span class="o">.</span><span class="n">rgi_id</span><span class="p">),</span> 
                          <span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;GCM&#39;</span><span class="p">,</span>  <span class="c1"># afterwards calculate the std of all GCMs</span>
                                <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="p">)</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>
</pre></div>
</div>
</div>
</div>
<p>This function takes a dataset <code class="docutils literal notranslate"><span class="pre">ds</span></code> and a variable name <code class="docutils literal notranslate"><span class="pre">variable</span></code> for which the mean and the std should be calculated. This function will come in handy in the next section dealing with the visualisation of the calculated values.</p>
<p>First, we create a single curve for a single RCP scenario:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate mean and std with the previously defined function</span>
<span class="n">total_volume_mean</span><span class="p">,</span> <span class="n">total_volume_std</span> <span class="o">=</span> <span class="n">calculate_total_mean_and_std</span><span class="p">(</span><span class="n">ds_merged</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">)</span>

<span class="c1"># select only on RCP scenario</span>
<span class="n">total_volume_mean_rcp85</span> <span class="o">=</span> <span class="n">total_volume_mean</span><span class="o">.</span><span class="n">loc</span><span class="p">[{</span><span class="s1">&#39;RCP&#39;</span><span class="p">:</span> <span class="s1">&#39;rcp85&#39;</span><span class="p">}]</span>

<span class="c1"># plot a curve</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">total_volume_mean_rcp85</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">total_volume_mean_rcp85</span>
<span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
         <span class="n">kdims</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
         <span class="n">vdims</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
               <span class="n">ylabel</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We used a <a class="reference external" href="https://holoviews.org/reference/elements/bokeh/Curve.html">HoloViews Curve</a> and defined <code class="docutils literal notranslate"><span class="pre">kdims</span></code> and <code class="docutils literal notranslate"><span class="pre">vdims</span></code>. This definition is not so important for a single plot but if we start to compose different plots all axis of the different plots with the same <code class="docutils literal notranslate"><span class="pre">kdims</span></code> or <code class="docutils literal notranslate"><span class="pre">vdims</span></code> are connected. This means for example whenever you zoom in on one plot all other plots also zoom in. Further, you can see that we have defined <code class="docutils literal notranslate"><span class="pre">xlabel</span></code> and <code class="docutils literal notranslate"><span class="pre">ylabel</span></code> using the variable description of the dataset, therefore it was useful to <code class="docutils literal notranslate"><span class="pre">keep_attrs=True</span></code> when we calculated the total values (see above).</p>
<p>As a next step we can add the std as a shaded area (<a class="reference external" href="https://holoviews.org/reference/elements/bokeh/Area.html">HoloViews Area</a>) and again define the whole plot as a single curve in a new function:</p>
<section id="create-single-mean-curve-with-std-area">
<h3>Create single mean curve with std area<a class="headerlink" href="#create-single-mean-curve-with-std-area" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_single_curve</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">rcp</span><span class="p">):</span>
    
    <span class="n">mean_use</span> <span class="o">=</span> <span class="n">mean</span><span class="o">.</span><span class="n">loc</span><span class="p">[{</span><span class="s1">&#39;RCP&#39;</span><span class="p">:</span> <span class="n">rcp</span><span class="p">}]</span>  <span class="c1"># read out the mean of the RCP to plot </span>
    <span class="n">std_use</span> <span class="o">=</span> <span class="n">std</span><span class="o">.</span><span class="n">loc</span><span class="p">[{</span><span class="s1">&#39;RCP&#39;</span><span class="p">:</span> <span class="n">rcp</span><span class="p">}]</span>  <span class="c1"># read out the std of the RCP to plot</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">mean</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>  <span class="c1"># get the time for the x axis</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="n">hv</span><span class="o">.</span><span class="n">Area</span><span class="p">((</span><span class="n">time</span><span class="p">,</span>  <span class="c1"># plot std as an area</span>
                     <span class="n">mean_use</span> <span class="o">+</span> <span class="n">std_use</span><span class="p">,</span>  <span class="c1"># upper boundary of the area</span>
                     <span class="n">mean_use</span> <span class="o">-</span> <span class="n">std_use</span><span class="p">),</span>  <span class="c1"># lower boundary of the area</span>
                    <span class="n">vdims</span><span class="o">=</span><span class="p">[</span><span class="n">mean_use</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;y2&#39;</span><span class="p">],</span>  <span class="c1"># vdims for both boundaries</span>
                    <span class="n">kdims</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">rcp</span><span class="p">,</span>
                   <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                          <span class="n">line_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="p">)</span> <span class="o">*</span>
            <span class="n">hv</span><span class="o">.</span><span class="n">Curve</span><span class="p">((</span><span class="n">time</span><span class="p">,</span> <span class="n">mean_use</span><span class="p">),</span>
                     <span class="n">vdims</span><span class="o">=</span><span class="n">mean_use</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                     <span class="n">kdims</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="n">rcp</span><span class="p">,</span>
                    <span class="p">)</span>
           <span class="p">)</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>  <span class="c1"># width of the total plot</span>
                  <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>  <span class="c1"># height of the total plot</span>
                  <span class="n">xlabel</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                  <span class="n">ylabel</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mean_use</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">mean_use</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                 <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="overlay-different-scenarios">
<h3>Overlay different scenarios<a class="headerlink" href="#overlay-different-scenarios" title="Permalink to this headline">#</a></h3>
<p>The single curves of the different scenarios we can put together in a <a class="reference external" href="https://holoviews.org/reference/containers/bokeh/HoloMap.html">HoloViews HoloMap</a>, which is comparable to a dictionary. This further can be easily used to create a nice overlay of all curves.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">overlay_scenarios</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
    <span class="n">hmap</span> <span class="o">=</span> <span class="n">hv</span><span class="o">.</span><span class="n">HoloMap</span><span class="p">(</span><span class="n">kdims</span><span class="o">=</span><span class="s1">&#39;Scenarios&#39;</span><span class="p">)</span>   <span class="c1"># create a HoloMap</span>
    <span class="n">mean</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">calculate_total_mean_and_std</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>  <span class="c1"># calculate mean and std for all RCPs using our previously defined function</span>
    <span class="k">for</span> <span class="n">rcp</span> <span class="ow">in</span> <span class="n">all_rcp</span><span class="p">:</span>
        <span class="n">hmap</span><span class="p">[</span><span class="n">rcp</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_single_curve</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">rcp</span><span class="p">)</span>  <span class="c1"># add a curve for each RCP to the HoloMap, using the RCP as a key (when you compare it do a dictonary)</span>
    <span class="k">return</span> <span class="n">hmap</span><span class="o">.</span><span class="n">overlay</span><span class="p">()</span><span class="o">.</span><span class="n">opts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">variable</span><span class="p">)</span>  <span class="c1"># create an overlay of all curves</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="show-different-variables-in-one-figure-and-save-as-html-file">
<h3>Show different variables in one figure and save as html file<a class="headerlink" href="#show-different-variables-in-one-figure-and-save-as-html-file" title="Permalink to this headline">#</a></h3>
<p>Now that we have defined how our plots should look like we can compose different variables we want to explore in one plot. To do so we can use Panel <a class="reference external" href="https://panel.holoviz.org/reference/layouts/Column.html">Column</a> and <a class="reference external" href="https://panel.holoviz.org/reference/layouts/Row.html">Row</a> for customization of the plot layout:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_plots</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">Row</span><span class="p">(</span><span class="n">overlay_scenarios</span><span class="p">(</span><span class="n">ds_merged</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">),</span>
                             <span class="n">overlay_scenarios</span><span class="p">(</span><span class="n">ds_merged</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">),</span>
                            <span class="p">),</span>
                      <span class="n">overlay_scenarios</span><span class="p">(</span><span class="n">ds_merged</span><span class="p">,</span> <span class="s1">&#39;melt_on_glacier&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_plots</span>
</pre></div>
</div>
</div>
</div>
<p>When you start exploring the plots by dragging them around or zooming in (using the tools of the toolboxes in the upper right corner of each plot) you see that the x-axes are connected. This makes it very convenient for example to look at different periods for all variables interactively.</p>
<p>You also can open the plots in a new browser tab by using</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">all_plots</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>or save it as a html file for sharing</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plots_to_save</span> <span class="o">=</span> <span class="n">pn</span><span class="o">.</span><span class="n">panel</span><span class="p">(</span><span class="n">all_plots</span><span class="p">)</span>
<span class="n">plots_to_save</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;GCM_runs.html&#39;</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="what-s-next">
<h2>What’s next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>return to the <a class="reference external" href="https://docs.oggm.org">OGGM documentation</a></p></li>
<li><p>back to the <span class="xref myst">table of contents</span></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/advanced"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="ingest_gridded_data_on_flowlines.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Ingest gridded products such as ice velocity into OGGM</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../others/holoviz_intro.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Small overview of HoloViz capability of data exploration</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By OGGM e.V. and OGGM Contributors<br/>
  
    <div class="extra_footer">
      <p>
These notebooks are licensed under a <a href="https://github.com/OGGM/tutorials/blob/master/LICENSE.txt" target="_blank">BSD-3-Clause license</a>.
<br>
&copy; Copyright 2014-2021.
</p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>