
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Step-by-Step guide to building preprocessed directories from scratch &#8212; OGGM tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/tutorials/building_the_prepro_gdirs';</script>
    <script data-domain="tutorials.oggm.org" defer="defer" src="https://plausible.oggm.org/js/script.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="What’s in my preprocessed directories? A full centerlines workflow, step by step" href="full_prepro_workflow.html" />
    <link rel="prev" title="Differences between the “elevation band” and “centerline” flowlines" href="elevation_bands_vs_centerlines.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
    <meta name="docbuild:last-update" content="Aug 25, 2024"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../welcome.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="OGGM tutorials - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="OGGM tutorials - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../welcome.html">
                    OGGM tutorials
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../book/10minutes.html">10 minutes tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../10minutes/preprocessed_directories.html">10 minutes to… a preprocessed directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10minutes/run_with_gcm.html">10 minutes to… a glacier change projection with GCM data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10minutes/machine_learning.html">10 minutes to… OGGM as an accelerator for machine learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10minutes/dynamical_spinup.html">10 minutes to… understand the new dynamical spinup in OGGM v1.6</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../../book/workflow.html">OGGM workflow</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="working_with_rgi.html">Working with the RGI and prepare glaciers for a run</a></li>
<li class="toctree-l2"><a class="reference internal" href="store_and_compress_glacierdirs.html">Storing glacier directories for later use</a></li>
<li class="toctree-l2"><a class="reference internal" href="deal_with_errors.html">Dealing with errors after a run</a></li>
<li class="toctree-l2"><a class="reference internal" href="elevation_bands_vs_centerlines.html">Differences between the “elevation band” and “centerline” flowlines</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Step-by-Step guide to building preprocessed directories from scratch</a></li>
<li class="toctree-l2"><a class="reference internal" href="full_prepro_workflow.html">What’s in my preprocessed directories? A full centerlines workflow, step by step</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../book/massbalance.html">Mass balance</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="massbalance_calibration.html">A look into the new mass balance calibration in OGGM v1.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot_mass_balance.html">Plotting the OGGM surface mass-balance, the ELA and AAR</a></li>

<li class="toctree-l2"><a class="reference internal" href="massbalance_global_params.html">Global distribution of the mass-balance model parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="massbalance_perturbation.html">Mass balance parameter perturbation experiments with OGGM</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../book/hydro.html">Hydrological output</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="hydrological_output.html">Hydrological mass-balance output</a></li>
<li class="toctree-l2"><a class="reference external" href="https://oggm.org/oggm-edu-notebooks/oggm-edu/glacier_water_resources.html">Glaciers as water resources (OGGM-Edu part 1 - idealized)</a></li>
<li class="toctree-l2"><a class="reference external" href="https://oggm.org/oggm-edu-notebooks/oggm-edu/glacier_water_resources_projections.html">Glaciers as water resources (OGGM-Edu part 2 - projections)</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../book/dynamics.html">Dynamical runs</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="run_with_a_spinup_and_gcm_data.html">Run with a long spinup and GCM data</a></li>
<li class="toctree-l2"><a class="reference internal" href="dynamical_spinup.html">Dynamic spinup and dynamic <em>melt_f</em> calibration for past simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="numeric_solvers.html">Understand the difference between the ice dynamic solvers in OGGM</a></li>

<li class="toctree-l2"><a class="reference internal" href="ioggm.html">“Instructed OGGM”: running IGM within the OGGM workflow</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../book/thickness.html">Ice thickness</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="inversion.html">Ice thickness inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="observed_thickness_with_dynamic_spinup.html">Dynamic model initialization using observed thickness data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../book/calving.html">Calving</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="kcalving_parameterization.html">The Oerlemans &amp; Nick frontal ablation parameterization in OGGM</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../book/shop.html">OGGM shop and additional data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="oggm_shop.html">OGGM-Shop and Glacier Directories in OGGM</a></li>
<li class="toctree-l2"><a class="reference internal" href="use_your_own_inventory.html">Using your our own glacier inventory with OGGM</a></li>
<li class="toctree-l2"><a class="reference internal" href="ingest_gridded_data_on_flowlines.html">Ingest gridded products such as ice velocity into OGGM</a></li>
<li class="toctree-l2"><a class="reference internal" href="dem_sources.html">Create local topography maps from different DEM sources with OGGM</a></li>
<li class="toctree-l2"><a class="reference internal" href="rgitopo_rgi6.html">Compare different DEMs for individual glaciers: RGI-TOPO for RGI v6.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="rgitopo_rgi7.html">RGI-TOPO for RGI 7.0</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../book/visualisation.html">Visualisation and post-processing</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="distribute_flowline.html">Display glacier area and thickness changes on a grid</a></li>
<li class="toctree-l2"><a class="reference internal" href="where_are_the_flowlines.html">OGGM flowlines: where are they?</a></li>
<li class="toctree-l2"><a class="reference internal" href="centerlines_to_shape.html">Compute smoother centerlines for shapefile output</a></li>
<li class="toctree-l2"><a class="reference internal" href="preprocessing_errors.html">Error analysis of the global pre-processing workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="merge_gcm_runs_and_visualize.html">Merge, analyse and visualize OGGM GCM runs</a></li>
<li class="toctree-l2"><a class="reference internal" href="holoviz_intro.html">Small overview of HoloViz capability of data exploration</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../book/construction.html">Tutorials in (re-)construction</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../construction/inversion_with_frontal_ablation.html">Ice thickness inversion with frontal ablation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../construction/area_length_filter.html">Filter the glacier length and area time series</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/OGGM/tutorials/stable?urlpath=lab/tree/./notebooks/tutorials/building_the_prepro_gdirs.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://hub.oggm.org/hub/user-redirect/git-pull?repo=https%3A//github.com/OGGM/tutorials&urlpath=lab/tree/tutorials/./notebooks/tutorials/building_the_prepro_gdirs.ipynb&branch=stable" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/OGGM/tutorials" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/OGGM/tutorials/edit/stable/./notebooks/tutorials/building_the_prepro_gdirs.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/OGGM/tutorials/issues/new?title=Issue%20on%20page%20%2Fnotebooks/tutorials/building_the_prepro_gdirs.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/tutorials/building_the_prepro_gdirs.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Step-by-Step guide to building preprocessed directories from scratch</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up">Set-up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-0">Level 0</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-1">Level 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-2">Level 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-3">Level 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-4">Level 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-5">Level 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-next">What’s next?</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="step-by-step-guide-to-building-preprocessed-directories-from-scratch">
<h1>Step-by-Step guide to building preprocessed directories from scratch<a class="headerlink" href="#step-by-step-guide-to-building-preprocessed-directories-from-scratch" title="Link to this heading">#</a></h1>
<p>This guide is for anyone who wants to learn how to start from scratch with building preprocessed directories, the same way OGGM does for its users. You might even use your own data. This tutorial assumes you are already familiar with OGGM basics. We won’t go into every little detail here, but you’ll find links for more information if you’re interested.</p>
<p>We’ve structured the guide into five main sections, each dedicated to a different level of preprocessing. At the beginning of each section, we’ll outline the tasks to be performed, the data we’ll use, and provide links to related tutorials. Additionally, at the end of each section, we’ll share a corresponding <code class="docutils literal notranslate"><span class="pre">prepro_base_url</span></code>. This URL allows you to start directly at that level with everything pre-setup, bypassing the need to complete the earlier steps. Plus, in the tutorial <a class="reference internal" href="store_and_compress_glacierdirs.html"><span class="std std-doc">storing glacier directories for later use</span></a>, we show you how to save your work. This way, you don’t have to redo everything from the beginning every time (many steps only need to be done once).</p>
<p><strong>Tags:</strong> advanced, glacier-directory, workflow</p>
<p>Tip: There’s a lot to learn here. If you’re curious about a specific function and want to know more, just add a question mark (?) right after it, and you’ll see more details.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example: Getting help on the Python function &#39;print&#39;</span>
print<span class="o">?</span>
</pre></div>
</div>
</div>
</div>
<section id="set-up">
<h2>Set-up<a class="headerlink" href="#set-up" title="Link to this heading">#</a></h2>
<p>First, let’s get everything ready to go. Here’s how we’ll do it:</p>
<ol class="arabic simple">
<li><p>Import Functions: We’ll start by importing the functions we need. Depending on which preprocessed level you’re working with, you might not need all of them.</p></li>
<li><p>Initialize OGGM: Next, we’ll set up OGGM and choose where we want to save our work (defining the working directory).</p></li>
<li><p>Choose a Glacier: Lastly, we’ll pick one glacier to focus on as our example.</p></li>
</ol>
<p>Remember, these steps are important no matter which level you’re starting from!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">oggm</span> <span class="kn">import</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">tasks</span><span class="p">,</span> <span class="n">DEFAULT_BASE_URL</span>

<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we always need to initialzie and define a working directory</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">logging_level</span><span class="o">=</span><span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s1">&#39;working_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="s1">&#39;OGGM-full_prepro_elevation_bands&#39;</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-25 21:07:33: oggm.cfg: Reading default parameters from the OGGM `params.cfg` configuration file.
2024-08-25 21:07:33: oggm.cfg: Multiprocessing switched OFF according to the parameter file.
2024-08-25 21:07:33: oggm.cfg: Multiprocessing: using all available processors (N=4)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Our example glacier</span>
<span class="n">rgi_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RGI60-11.00897&#39;</span><span class="p">]</span>  <span class="c1"># Hintereisferner</span>
<span class="n">rgi_region</span> <span class="o">=</span> <span class="s1">&#39;11&#39;</span>  <span class="c1"># this must fit to example glacier(s), if starting from level 0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This section is only for future developments of the tutorial (e.g. updateing for new OGGM releases)</span>
<span class="c1"># Test if prepro_base_url valid for both flowline_type_to_use, see level 2.</span>
<span class="c1"># In total four complete executions of the notebook:</span>
<span class="c1"># (load_from_prepro_base_url=False/True and flowline_type_to_use = &#39;elevation_band&#39;/&#39;centerline&#39;)</span>
<span class="n">load_from_prepro_base_url</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="level-0">
<h2>Level 0<a class="headerlink" href="#level-0" title="Link to this heading">#</a></h2>
<p>Tasks:</p>
<ul class="simple">
<li><p>Define the <code class="docutils literal notranslate"><span class="pre">rgi_id</span></code> for your glacier directory <code class="docutils literal notranslate"><span class="pre">gdir</span></code>.</p></li>
<li><p>Define the map projection of the glacier directory</p></li>
<li><p>Add an outline of the glacier.</p></li>
<li><p>Optionally add intersects to other outlines.</p></li>
</ul>
<p>Data used:</p>
<ul class="simple">
<li><p>Glacier outline</p></li>
<li><p>Optionally intersects</p></li>
</ul>
<p>Related Tutorials:</p>
<ul class="simple">
<li><p><a class="reference internal" href="working_with_rgi.html"><span class="std std-doc">working_with_rgi</span></a> will show you how to read glacier outline files and prepare them for a run</p></li>
<li><p><a class="reference internal" href="use_your_own_inventory.html"><span class="std std-doc">use_your_own_inventory</span></a>: Use custom glacier inventories with OGGM</p></li>
</ul>
<div class="alert alert-danger">
    <b> CAUTION: </b>
        When using your own glacier outlines, it's important to note that OGGM relies on the defined RGI_ID to fetch calibration data from global datasets, which are tailored to the RGI outlines. If your glacier's outline significantly deviates from its RGI counterpart, this could introduce errors, potentially large or small, into your model's results. Ideally, you should provide your own calibration data for custom outlines or, at the very least, be mindful of the discrepancies this might cause.
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load all RGI outlines for our region and extract the example glaciers</span>
<span class="n">rgidf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_rgi_region_file</span><span class="p">(</span><span class="n">rgi_region</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;62&#39;</span><span class="p">))</span>
<span class="n">rgidf</span> <span class="o">=</span> <span class="n">rgidf</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">rgidf</span><span class="o">.</span><span class="n">RGIId</span><span class="p">,</span> <span class="n">rgi_ids</span><span class="p">)]</span>

<span class="c1"># We also take care of intersects for this RGI version</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">set_intersects_db</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_rgi_intersects_region_file</span><span class="p">(</span><span class="n">rgi_region</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;62&#39;</span><span class="p">))</span>

<span class="c1"># set the used projection used for gdir, options &#39;tmerc&#39; or &#39;utm&#39;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;map_proj&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;map_proj&#39;</span><span class="p">]</span>  <span class="c1"># default is &#39;tmerc&#39;</span>

<span class="n">gdirs</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgidf</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-25 21:07:40: oggm.workflow: Execute entity tasks [GlacierDirectory] on 1 glaciers
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instruction for beginning with existing OGGM&#39;s preprocessed directories</span>
<span class="k">if</span> <span class="n">load_from_prepro_base_url</span><span class="p">:</span>
    <span class="c1"># to start from level 0 you can do</span>
    <span class="n">prepro_base_url_L0</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L1-L2_files/elev_bands/&#39;</span>
    <span class="n">gdirs</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgi_ids</span><span class="p">,</span>
                                              <span class="n">from_prepro_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                              <span class="n">prepro_base_url</span><span class="o">=</span><span class="n">prepro_base_url_L0</span><span class="p">,</span>
                                              <span class="n">prepro_border</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="c1"># could be 10, 80, 160 or 240</span>
                                              <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="level-1">
<h2>Level 1<a class="headerlink" href="#level-1" title="Link to this heading">#</a></h2>
<p>Tasks:</p>
<ul class="simple">
<li><p>Define the border around the outline.</p></li>
<li><p>Define the local grid resolution, which will also set the resolution for the flowlines.</p></li>
<li><p>Add the digital elevation model DEM.</p></li>
<li><p>Set up a local grid for each <code class="docutils literal notranslate"><span class="pre">gdir</span></code>.</p></li>
</ul>
<p>Data used:</p>
<ul class="simple">
<li><p>DEM file</p></li>
</ul>
<p>Related Tutorials:</p>
<ul class="simple">
<li><p><a class="reference internal" href="dem_sources.html"><span class="std std-doc">dem_sources</span></a>: Create local topography maps from different DEM sources with OGGM</p></li>
<li><p><a class="reference internal" href="rgitopo_rgi6.html"><span class="std std-doc">rgitopo_rgi6</span></a>: RGI-TOPO for RGI v6.0</p></li>
</ul>
<div class="alert alert-info">
        Please note that registration may be required to access some of the DEM sources. For more information, refer to the <a href="https://oggm.org/tutorials/master/notebooks/tutorials/dem_sources.html#register-for-online-datasets">dem_sources tutorial</a>.
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the border, we keep the default here</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;border&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;border&#39;</span><span class="p">]</span>

<span class="c1"># set the method for determining the local grid resolution</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;grid_dx_method&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;grid_dx_method&#39;</span><span class="p">]</span>  <span class="c1"># The default method is &#39;square&#39;, which determines the grid spacing (dx) based on the glacier&#39;s outline area.</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;fixed_dx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;fixed_dx&#39;</span><span class="p">]</span>  <span class="c1"># This allows setting a specific resolution in meters. It&#39;s applicable only when grid_dx_method is set to &#39;fixed&#39;.</span>

<span class="c1"># set the DEM source to use</span>
<span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;COPDEM90&#39;</span>  <span class="c1"># we use COPDEM here</span>

<span class="c1"># this task adds the DEM and defines the local grid</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">define_glacier_region</span><span class="p">,</span> 
                             <span class="n">gdirs</span><span class="p">,</span>
                             <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-25 21:07:40: oggm.workflow: Execute entity tasks [define_glacier_region] on 1 glaciers
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instruction for beginning with existing OGGM&#39;s preprocessed directories</span>
<span class="k">if</span> <span class="n">load_from_prepro_base_url</span><span class="p">:</span>
    <span class="c1"># to start from level 1 you can do</span>
    <span class="n">prepro_base_url_L1</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L1-L2_files/elev_bands/&#39;</span>
    <span class="n">gdirs</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgi_ids</span><span class="p">,</span>
                                              <span class="n">from_prepro_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                              <span class="n">prepro_base_url</span><span class="o">=</span><span class="n">prepro_base_url_L1</span><span class="p">,</span>
                                              <span class="n">prepro_border</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="c1"># could be 10, 80, 160 or 240</span>
                                              <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="level-2">
<h2>Level 2<a class="headerlink" href="#level-2" title="Link to this heading">#</a></h2>
<p>Tasks:</p>
<ul class="simple">
<li><p>Choose the type of flowline to use.</p></li>
<li><p>Create the flowlines surface structure, including surface height and width.</p></li>
<li><p>Create the downstream flowline, which starts from the glacier’s terminus and extends downstream.</p></li>
<li><p>Optionally you can bring in extra data from the OGGM-shop and bin it to the elevation band flowline.</p></li>
</ul>
<p>Data used:</p>
<ul class="simple">
<li><p>Outline</p></li>
<li><p>DEM</p></li>
<li><p>Optional: additional datasets</p></li>
</ul>
<p>Related Tutorials:</p>
<ul class="simple">
<li><p><a class="reference internal" href="elevation_bands_vs_centerlines.html"><span class="std std-doc">elevation_bands_vs_centerlines</span></a>: Differences between “elevation band” and “centerline” flowlines</p></li>
<li><p><a class="reference internal" href="numeric_solvers.html"><span class="std std-doc">numeric_solvers</span></a>: Understand the difference between the ice dynamic solvers in OGGM</p></li>
<li><p><a class="reference internal" href="oggm_shop.html"><span class="std std-doc">oggm_shop</span></a>: OGGM-Shop and Glacier Directories in OGGM</p></li>
<li><p><a class="reference internal" href="ingest_gridded_data_on_flowlines.html"><span class="std std-doc">ingest_gridded_data_on_flowlines</span></a>: ingest gridded products such as ice velocity into OGGM (and compare them with model output)</p></li>
</ul>
<div class="alert alert-info">
        Starting from this point, it's important to choose the prepro_base_url based on the type of flowline you're working with (see end of this chapter).
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flowline_type_to_use</span> <span class="o">=</span> <span class="s1">&#39;elevation_band&#39;</span>  <span class="c1"># you can also select &#39;centerline&#39; here</span>

<span class="k">if</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;elevation_band&#39;</span><span class="p">:</span>
    <span class="n">elevation_band_task_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">simple_glacier_masks</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">elevation_band_flowline</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">fixed_dx_elevation_band_flowline</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">compute_downstream_line</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">compute_downstream_bedshape</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">elevation_band_task_list</span><span class="p">:</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">);</span>

<span class="k">elif</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;centerline&#39;</span><span class="p">:</span>
    <span class="c1"># for centerline we can use parabola downstream line</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;downstream_line_shape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;parabola&#39;</span>

    <span class="n">centerline_task_list</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">glacier_masks</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">compute_centerlines</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">initialize_flowlines</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">catchment_area</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">catchment_intersections</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">catchment_width_geom</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">catchment_width_correction</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">compute_downstream_line</span><span class="p">,</span>
        <span class="n">tasks</span><span class="o">.</span><span class="n">compute_downstream_bedshape</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">centerline_task_list</span><span class="p">:</span>
        <span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">);</span>
    
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flowline type &#39;</span><span class="si">{</span><span class="n">flowline_type_to_use</span><span class="si">}</span><span class="s2">&#39;! Select &#39;elevation_band&#39; or &#39;centerline&#39;!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-25 21:07:41: oggm.workflow: Execute entity tasks [simple_glacier_masks] on 1 glaciers
2024-08-25 21:07:41: oggm.workflow: Execute entity tasks [elevation_band_flowline] on 1 glaciers
2024-08-25 21:07:41: oggm.workflow: Execute entity tasks [fixed_dx_elevation_band_flowline] on 1 glaciers
2024-08-25 21:07:41: oggm.workflow: Execute entity tasks [compute_downstream_line] on 1 glaciers
2024-08-25 21:07:41: oggm.workflow: Execute entity tasks [compute_downstream_bedshape] on 1 glaciers
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instruction for beginning with existing OGGM&#39;s preprocessed directories</span>
<span class="k">if</span> <span class="n">load_from_prepro_base_url</span><span class="p">:</span>
    <span class="c1"># to start from level 2 we need to distinguish between the flowline types</span>
    <span class="k">if</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;elevation_band&#39;</span><span class="p">:</span>
        <span class="n">prepro_base_url_L2</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L1-L2_files/2023.2/elev_bands_w_data/&#39;</span>
    <span class="k">elif</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;centerline&#39;</span><span class="p">:</span>
        <span class="n">prepro_base_url_L2</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L1-L2_files/centerlines/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flowline type &#39;</span><span class="si">{</span><span class="n">flowline_type_to_use</span><span class="si">}</span><span class="s2">&#39;! Select &#39;elevation_band&#39; or &#39;centerline&#39;!&quot;</span><span class="p">)</span>

    <span class="n">gdirs</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgi_ids</span><span class="p">,</span>
                                              <span class="n">from_prepro_level</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                              <span class="n">prepro_base_url</span><span class="o">=</span><span class="n">prepro_base_url_L2</span><span class="p">,</span>
                                              <span class="n">prepro_border</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="c1"># could be 10, 80, 160 or 240</span>
                                              <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="level-3">
<h2>Level 3<a class="headerlink" href="#level-3" title="Link to this heading">#</a></h2>
<p>Tasks:</p>
<ul class="simple">
<li><p>Add baseline climate data to gdir.</p></li>
<li><p>Calibrate the mass balance model statically (without considering glacier dynamics) using geodetic observations. This involves the calibration of <code class="docutils literal notranslate"><span class="pre">melt_f</span></code>, <code class="docutils literal notranslate"><span class="pre">prcp_fac</span></code> and <code class="docutils literal notranslate"><span class="pre">temp_bias</span></code>.</p></li>
<li><p>Conduct an inversion for the glacier’s bed topography. Including the calibration of <code class="docutils literal notranslate"><span class="pre">glen_a</span></code> and <code class="docutils literal notranslate"><span class="pre">fs</span></code> by matching to the total volume estimate.</p></li>
<li><p>Create the dynamic flowline for dynamic simulation runs.</p></li>
</ul>
<p>Data used:</p>
<ul class="simple">
<li><p>Climate data (default source: <a class="reference external" href="https://www.isimip.org/gettingstarted/input-data-bias-adjustment/details/80/">GSWP3_W5E5</a>)</p></li>
<li><p>Geodetic mass balance observations (default source: <a class="reference external" href="https://www.nature.com/articles/s41586-021-03436-z">Hugonnet al. 2021</a>)</p></li>
<li><p>Volume estimate (default source: <a class="reference external" href="https://www.nature.com/articles/s41561-019-0300-3">Farinotti et al. (2019)</a>)</p></li>
</ul>
<p>Related Tutorials:</p>
<ul class="simple">
<li><p><a class="reference internal" href="oggm_shop.html"><span class="std std-doc">oggm_shop</span></a>: OGGM-Shop and Glacier Directories in OGGM</p></li>
<li><p><a class="reference internal" href="massbalance_calibration.html"><span class="std std-doc">massbalance_calibration</span></a>: A look into the new mass balance calibration in OGGM v1.6</p></li>
<li><p><a class="reference internal" href="massbalance_perturbation.html"><span class="std std-doc">massbalance_perturbation</span></a>: Mass balance parameter perturbation experiments</p></li>
<li><p><a class="reference internal" href="inversion.html"><span class="std std-doc">inversion</span></a>: run the OGGM ice thickness inversion model with various ice parameters</p></li>
</ul>
<div class="alert alert-info">
        For the inversion, we diverge from the standard preprocessed directories when focusing on individual glaciers instead of entire regions. This is because calibrate_inversion_from_consensus adjusts glacier volume based on total regional consensus estimates, not per glacier. Since volume estimates are model-based and not directly observed, they're less reliable for individual calibration. However, for our example, we'll calibrate using the consensus estimate for a single glacier, differing from the preprocessed approach.
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the climate data to use, we keep the default</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;baseline_climate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;baseline_climate&#39;</span><span class="p">]</span>

<span class="c1"># add climate data to gdir</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">process_climate_data</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">);</span>

<span class="c1"># the default mb calibration</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">mb_calibration_from_geodetic_mb</span><span class="p">,</span>
                             <span class="n">gdirs</span><span class="p">,</span>
                             <span class="n">informed_threestep</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># only available for &#39;GSWP3_W5E5&#39;</span>
                            <span class="p">);</span>

<span class="c1"># glacier bed inversion</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">apparent_mb_from_any_mb</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">);</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">calibrate_inversion_from_consensus</span><span class="p">(</span>
    <span class="n">gdirs</span><span class="p">,</span>
    <span class="n">apply_fs_on_mismatch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">error_on_mismatch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># if you running many glaciers some might not work</span>
    <span class="n">filter_inversion_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># this partly filters the overdeepening due to</span>
    <span class="c1"># the equilibrium assumption for retreating glaciers (see. Figure 5 of Maussion et al. 2019)</span>
    <span class="n">volume_m3_reference</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># here you could provide your own total volume estimate in m3</span>
<span class="p">);</span>

<span class="c1"># finally create the dynamic flowlines</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">init_present_time_glacier</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-25 21:07:41: oggm.workflow: Execute entity tasks [process_climate_data] on 1 glaciers
2024-08-25 21:07:41: oggm.workflow: Execute entity tasks [mb_calibration_from_geodetic_mb] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [apparent_mb_from_any_mb] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Applying global task calibrate_inversion_from_consensus on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Consensus estimate optimisation with A factor: 0.1 and fs: 0
2024-08-25 21:07:42: oggm.workflow: Applying global task inversion_tasks on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [prepare_for_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [mass_conservation_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [filter_inversion_output] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [get_inversion_volume] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Consensus estimate optimisation with A factor: 10.0 and fs: 0
2024-08-25 21:07:42: oggm.workflow: Applying global task inversion_tasks on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [prepare_for_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [mass_conservation_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [filter_inversion_output] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [get_inversion_volume] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Consensus estimate optimisation with A factor: 7.876802795318141 and fs: 0
2024-08-25 21:07:42: oggm.workflow: Applying global task inversion_tasks on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [prepare_for_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [mass_conservation_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [filter_inversion_output] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [get_inversion_volume] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Consensus estimate optimisation with A factor: 3.98840139765907 and fs: 0
2024-08-25 21:07:42: oggm.workflow: Applying global task inversion_tasks on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [prepare_for_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [mass_conservation_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [filter_inversion_output] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [get_inversion_volume] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Consensus estimate optimisation with A factor: 2.044200698829535 and fs: 0
2024-08-25 21:07:42: oggm.workflow: Applying global task inversion_tasks on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [prepare_for_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [mass_conservation_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [filter_inversion_output] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [get_inversion_volume] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Consensus estimate optimisation with A factor: 2.869309409059597 and fs: 0
2024-08-25 21:07:42: oggm.workflow: Applying global task inversion_tasks on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [prepare_for_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [mass_conservation_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [filter_inversion_output] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [get_inversion_volume] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Consensus estimate optimisation with A factor: 2.7157333579518252 and fs: 0
2024-08-25 21:07:42: oggm.workflow: Applying global task inversion_tasks on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [prepare_for_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [mass_conservation_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [filter_inversion_output] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [get_inversion_volume] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Consensus estimate optimisation with A factor: 2.6897121901531937 and fs: 0
2024-08-25 21:07:42: oggm.workflow: Applying global task inversion_tasks on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [prepare_for_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [mass_conservation_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [filter_inversion_output] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [get_inversion_volume] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: calibrate_inversion_from_consensus converged after 7 iterations and fs=0. The resulting Glen A factor is 2.6897121901531937.
2024-08-25 21:07:42: oggm.workflow: Applying global task inversion_tasks on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [prepare_for_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [mass_conservation_inversion] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [filter_inversion_output] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [get_inversion_volume] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [init_present_time_glacier] on 1 glaciers
</pre></div>
</div>
</div>
</div>
<p><strong>Guidance on utilizing various baseline climates:</strong></p>
<p>Currently, OGGM supports a variety of baseline climates, including ‘CRU’, ‘HISTALP’, ‘W5E5’, ‘GSWP3_W5E5’ (the default), ‘ERA5’, ‘ERA5L’, ‘CERA’, ‘ERA5dr’, and ‘ERA5L-HMA’. Although switching between these datasets is straightforward, calibrating the mass balance model according to each dataset is more complex. For instance, you’ll need to choose a default precipitation factor that suits both your selected climate dataset and your specific region. Additionally, you must determine the best method to calibrate the mass balance parameters. For a comprehensive guide on the available options, explanations, and how to incorporate your own geodetic observations, please refer to the tutorial <a class="reference internal" href="massbalance_calibration.html"><span class="std std-doc">massbalance_calibration</span></a>.</p>
<p>Here’s an example of using the ERA5 dataset:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the baseline climate and add it</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;baseline_climate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ERA5&#39;</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">process_climate_data</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">);</span>

<span class="c1"># define the default precipitation factor</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;prcp_fac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.6</span>  <span class="c1"># Note: This is not a universial value!</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;use_winter_prcp_fac&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># This option is only available for &#39;GSWP3_W5E5&#39;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;use_temp_bias_from_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># This option is only available for &#39;GSWP3_W5E5&#39;</span>

<span class="c1"># an example of static calibration for mass balance, more options are available in the tutorial</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">mb_calibration_from_geodetic_mb</span><span class="p">,</span>
                             <span class="n">gdirs</span><span class="p">,</span>
                             <span class="n">calibrate_param1</span><span class="o">=</span><span class="s1">&#39;melt_f&#39;</span><span class="p">,</span>
                             <span class="n">calibrate_param2</span><span class="o">=</span><span class="s1">&#39;prcp_fac&#39;</span><span class="p">,</span>
                             <span class="n">calibrate_param3</span><span class="o">=</span><span class="s1">&#39;temp_bias&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can also utilize your own climate data. However, you will need to either convert your data into a specific format (for an example, see <a class="github reference external" href="https://github.com/OGGM/oggm-sample-data">OGGM/oggm-sample-data</a> -&gt;test-files/histalp_merged_hef.nc) or create your own <code class="docutils literal notranslate"><span class="pre">tasks.process_climate_data</span></code> function. Here’s how you might do this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;baseline_climate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CUSTOM&#39;</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s1">&#39;climate_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_to_the_climate_file</span>

<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">process_climate_data</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">);</span>

<span class="c1"># proceed with defining the default precipitation factor and mass balance calibration as shown above</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instruction for beginning with existing OGGM&#39;s preprocessed directories</span>
<span class="k">if</span> <span class="n">load_from_prepro_base_url</span><span class="p">:</span>
    <span class="c1"># to start from level 3 you can do</span>
    <span class="k">if</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;elevation_band&#39;</span><span class="p">:</span>
        <span class="n">prepro_base_url_L3</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L3-L5_files/2023.3/elev_bands/W5E5/&#39;</span>
    <span class="k">elif</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;centerline&#39;</span><span class="p">:</span>
        <span class="n">prepro_base_url_L3</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L3-L5_files/2023.3/centerlines/W5E5/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flowline type &#39;</span><span class="si">{</span><span class="n">flowline_type_to_use</span><span class="si">}</span><span class="s2">&#39;! Select &#39;elevation_band&#39; or &#39;centerline&#39;!&quot;</span><span class="p">)</span>

    <span class="n">gdirs</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgi_ids</span><span class="p">,</span>
                                              <span class="n">from_prepro_level</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                              <span class="n">prepro_base_url</span><span class="o">=</span><span class="n">prepro_base_url_L3</span><span class="p">,</span>
                                              <span class="n">prepro_border</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="c1"># could be 80 or 160</span>
                                              <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="level-4">
<h2>Level 4<a class="headerlink" href="#level-4" title="Link to this heading">#</a></h2>
<p>Tasks:</p>
<ul class="simple">
<li><p>Initialize the current state of the glacier without a dynamic spinup. This method, default until version 1.6., is mainly for comparison purposes and can often be skipped.</p></li>
<li><p>Initialize the current glacier state with a dynamic spinup. This process includes a dynamic calibration of the mass balance. It’s important to note that this option isn’t available for centerlines in the current OGGM preprocessed directories, meaning it hasn’t been tested or analyzed.</p></li>
</ul>
<p>Data used:</p>
<ul class="simple">
<li><p>Geodetic mass balance observations (default source: <a class="reference external" href="https://www.nature.com/articles/s41586-021-03436-z">Hugonnet al. 2021</a>)</p></li>
</ul>
<p>Related Tutorials:</p>
<ul class="simple">
<li><p>10 minutes to… <a class="reference internal" href="../10minutes/dynamical_spinup.html"><span class="std std-doc">the new dynamical spinup in OGGM v1.6</span></a></p></li>
<li><p><a class="reference internal" href="dynamical_spinup.html"><span class="std std-doc">dynamical_spinup</span></a>: a deeper dive into the dynamical spinup for past simulations</p></li>
<li><p><a class="reference internal" href="numeric_solvers.html"><span class="std std-doc">numeric_solvers</span></a>: Understand the difference between the ice dynamic solvers in OGGM</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set the ice dynamic solver depending on the flowline-type</span>
<span class="k">if</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;elevation_band&#39;</span><span class="p">:</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;evolution_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SemiImplicit&#39;</span>
<span class="k">elif</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;centerline&#39;</span><span class="p">:</span>
    <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;evolution_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FluxBased&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flowline type &#39;</span><span class="si">{</span><span class="n">flowline_type_to_use</span><span class="si">}</span><span class="s2">&#39;! Select &#39;elevation_band&#39; or &#39;centerline&#39;!&quot;</span><span class="p">)</span>

<span class="c1"># get the start and end year of the selected baseline</span>
<span class="n">y0</span> <span class="o">=</span> <span class="n">gdirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_climate_info</span><span class="p">()[</span><span class="s1">&#39;baseline_yr_0&#39;</span><span class="p">]</span>
<span class="n">ye</span> <span class="o">=</span> <span class="n">gdirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_climate_info</span><span class="p">()[</span><span class="s1">&#39;baseline_yr_1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># run really to the end until 1.1.</span>

<span class="c1"># &#39;static&#39; initialisation</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">run_from_climate_data</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">,</span>
                             <span class="n">min_ys</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span> <span class="n">ye</span><span class="o">=</span><span class="n">ye</span><span class="p">,</span>
                             <span class="n">fixed_geometry_spinup_yr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># here you could add a static spinup if you want</span>
                             <span class="n">output_filesuffix</span><span class="o">=</span><span class="s1">&#39;_historical&#39;</span><span class="p">)</span>

<span class="c1"># &#39;dynamic&#39; initialisation, including dynamic mb calibration</span>
<span class="n">dynamic_spinup_start_year</span> <span class="o">=</span> <span class="mi">1979</span>
<span class="n">minimise_for</span> <span class="o">=</span> <span class="s1">&#39;area&#39;</span>  <span class="c1"># other option would be &#39;volume&#39;</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span>
    <span class="n">tasks</span><span class="o">.</span><span class="n">run_dynamic_melt_f_calibration</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">,</span>
    <span class="n">err_dmdtda_scaling_factor</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># by default we reduce the mass balance error for accounting for</span>
    <span class="c1"># corrleated uncertainties on a regional scale</span>
    <span class="n">ys</span><span class="o">=</span><span class="n">dynamic_spinup_start_year</span><span class="p">,</span> <span class="n">ye</span><span class="o">=</span><span class="n">ye</span><span class="p">,</span>
    <span class="n">kwargs_run_function</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;minimise_for&#39;</span><span class="p">:</span> <span class="n">minimise_for</span><span class="p">},</span>
    <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">kwargs_fallback_function</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;minimise_for&#39;</span><span class="p">:</span> <span class="n">minimise_for</span><span class="p">},</span>
    <span class="n">output_filesuffix</span><span class="o">=</span><span class="s1">&#39;_spinup_historical&#39;</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [run_from_climate_data] on 1 glaciers
2024-08-25 21:07:42: oggm.workflow: Execute entity tasks [run_dynamic_melt_f_calibration] on 1 glaciers
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instruction for beginning with existing OGGM&#39;s preprocessed directories</span>
<span class="k">if</span> <span class="n">load_from_prepro_base_url</span><span class="p">:</span>
    <span class="c1"># to start from level 4 you can do</span>
    <span class="k">if</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;elevation_band&#39;</span><span class="p">:</span>
        <span class="n">prepro_base_url_L4</span> <span class="o">=</span> <span class="n">DEFAULT_BASE_URL</span>
    <span class="k">elif</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;centerline&#39;</span><span class="p">:</span>
        <span class="n">prepro_base_url_L4</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L3-L5_files/2023.3/centerlines/W5E5/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flowline type &#39;</span><span class="si">{</span><span class="n">flowline_type_to_use</span><span class="si">}</span><span class="s2">&#39;! Select &#39;elevation_band&#39; or &#39;centerline&#39;!&quot;</span><span class="p">)</span>
    <span class="n">gdirs</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgi_ids</span><span class="p">,</span>
                                              <span class="n">from_prepro_level</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                              <span class="n">prepro_base_url</span><span class="o">=</span><span class="n">prepro_base_url_L4</span><span class="p">,</span>
                                              <span class="n">prepro_border</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="c1"># could be 80 or 160</span>
                                              <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="level-5">
<h2>Level 5<a class="headerlink" href="#level-5" title="Link to this heading">#</a></h2>
<p>Tasks:</p>
<ul class="simple">
<li><p>Retain only the data necessary for future projection runs to conserve disk space. At this stage, it’s not possible to revisit the preprocessing steps from earlier levels, but all required information for conducting future projection runs is preserved.</p></li>
</ul>
<p>Data used:</p>
<ul class="simple">
<li><p>No additional data is needed for this level.</p></li>
</ul>
<p>Related Tutorials:</p>
<ul class="simple">
<li><p><a class="reference internal" href="store_and_compress_glacierdirs.html"><span class="std std-doc">store_and_compress_glacierdirs</span></a>: storing glacier directories for later use</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mini_base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s1">&#39;working_dir&#39;</span><span class="p">],</span>
                             <span class="s1">&#39;mini_per_glacier&#39;</span><span class="p">)</span>
<span class="n">mini_gdirs</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">execute_entity_task</span><span class="p">(</span><span class="n">tasks</span><span class="o">.</span><span class="n">copy_to_basedir</span><span class="p">,</span> <span class="n">gdirs</span><span class="p">,</span>
                                          <span class="n">base_dir</span><span class="o">=</span><span class="n">mini_base_dir</span><span class="p">,</span>
                                          <span class="n">setup</span><span class="o">=</span><span class="s1">&#39;run/spinup&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-08-25 21:07:45: oggm.workflow: Execute entity tasks [copy_to_basedir] on 1 glaciers
</pre></div>
</div>
</div>
</div>
<div class="alert alert-info">
        When you're ready to access your work later, you should first remove the 'per_glacier' folder from your working directory. Then, rename the 'mini_per_glacier' folder to 'per_glacier'. Remember, proceed with these steps only if you've completed setting up your glacier directories (gdirs) and are sure you won't need to make further changes!
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instruction for beginning with existing OGGM&#39;s preprocessed directories</span>
<span class="k">if</span> <span class="n">load_from_prepro_base_url</span><span class="p">:</span>
    <span class="c1"># to start from level 5 you can do</span>
    <span class="k">if</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;elevation_band&#39;</span><span class="p">:</span>
        <span class="n">prepro_base_url_L5</span> <span class="o">=</span> <span class="n">DEFAULT_BASE_URL</span>
    <span class="k">elif</span> <span class="n">flowline_type_to_use</span> <span class="o">==</span> <span class="s1">&#39;centerline&#39;</span><span class="p">:</span>
        <span class="n">prepro_base_url_L5</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L3-L5_files/2023.3/centerlines/W5E5/&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown flowline type &#39;</span><span class="si">{</span><span class="n">flowline_type_to_use</span><span class="si">}</span><span class="s2">&#39;! Select &#39;elevation_band&#39; or &#39;centerline&#39;!&quot;</span><span class="p">)</span>
    <span class="n">gdirs</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgi_ids</span><span class="p">,</span>
                                              <span class="n">from_prepro_level</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                                              <span class="n">prepro_base_url</span><span class="o">=</span><span class="n">prepro_base_url_L5</span><span class="p">,</span>
                                              <span class="n">prepro_border</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>  <span class="c1"># could be 80 or 160</span>
                                              <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And that’s it! We’ve successfully recreated all the preprocessed levels offered by OGGM. Remember, if you prefer, you can bypass all previous steps and jump straight into your future projections from Level 5. Happy modeling!</p>
</section>
<section id="what-s-next">
<h2>What’s next?<a class="headerlink" href="#what-s-next" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>return to the <a class="reference external" href="https://docs.oggm.org">OGGM documentation</a></p></li>
<li><p>back to the <a class="reference internal" href="../welcome.html"><span class="std std-doc">table of contents</span></a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="elevation_bands_vs_centerlines.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Differences between the “elevation band” and “centerline” flowlines</p>
      </div>
    </a>
    <a class="right-next"
       href="full_prepro_workflow.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">What’s in my preprocessed directories? A full centerlines workflow, step by step</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up">Set-up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-0">Level 0</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-1">Level 1</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-2">Level 2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-3">Level 3</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-4">Level 4</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#level-5">Level 5</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-next">What’s next?</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By OGGM e.V. and OGGM Contributors
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
  Last updated on Aug 25, 2024.
  <br/>
</p>
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
These notebooks are licensed under a <a href="https://github.com/OGGM/tutorials/blob/master/LICENSE.txt" target="_blank">BSD-3-Clause license</a>.
<br>
&copy; Copyright 2014-2024.
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>