

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>10 minutes to… understand difference between ice dynamic models &#8212; OGGM tutorials</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-106829797-2"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'UA-106829797-2');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/10minutes/numeric_solvers';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../welcome.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../welcome.html">
                    Welcome to the OGGM tutorials!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">10 minutes tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="preprocessed_directories.html">10 minutes to… a preprocessed directory</a></li>
<li class="toctree-l1"><a class="reference internal" href="run_with_gcm.html">10 minutes to… a glacier change projection with GCM data</a></li>
<li class="toctree-l1"><a class="reference internal" href="machine_learning.html">10 minutes to… OGGM as an accelerator for modelling and machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="elevation_bands_vs_centerlines.html">10 minutes to… “elevation band” and “centerline” flowlines</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamical_spinup.html">10 minutes to… understand the new dynamical spinup in OGGM v1.6</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Beginner tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../beginner/working_with_rgi.html">Working with the RGI files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/store_and_compress_glacierdirs.html">Storing glacier directories for later use</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/plot_mass_balance.html">Plotting the OGGM surface mass-balance, the ELA and AAR</a></li>

<li class="toctree-l1"><a class="reference internal" href="../beginner/distribute_flowline.html">Compute area and thickness changes on a grid (nice, but experimental!)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/deal_with_errors.html">Dealing with errors after a run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/inversion.html">Ice thickness inversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/hydrological_output.html">Hydrological mass-balance output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/oggm_shop.html">OGGM-Shop and Glacier Directories in OGGM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beginner/full_prepro_workflow.html">What’s in my preprocessed directories with centerlines? A full OGGM workflow, step by step</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../advanced/preprocessing_errors.html">Error analysis of the global pre-processing workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/run_with_a_spinup_and_gcm_data.html">Run with a spinup and GCM data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/dem_sources.html">Create local topography maps from different DEM sources with OGGM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/use_your_own_inventory.html">Using your our own glacier inventory with OGGM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/centerlines_to_shape.html">Compute smoother centerlines for shapefile output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/massbalance_calibration.html">A look into the new mass balance calibration in OGGM v1.6</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/where_are_the_flowlines.html">OGGM flowlines: where are they?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/ingest_gridded_data_on_flowlines.html">Ingest gridded products such as ice velocity into OGGM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/merge_gcm_runs_and_visualize.html">Merge, analyse and visualize OGGM GCM runs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/dynamical_spinup.html">Dynamic spinup and dynamic <em>melt_f</em> calibration for past simulations</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">RGI-TOPO</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../others/rgitopo_rgi6.html">Compare different DEMs for individual glaciers: RGI-TOPO for RGI v6.0https://cluster.klima.uni-bremen.de/data/gdirs/dems_v2/default https://cluster.klima.uni-bremen.de/data/gdirs/dems_v2/default https://cluster.klima.uni-bremen.de/data/gdirs/dems_v2/default</a></li>
<li class="toctree-l1"><a class="reference internal" href="../others/rgitopo_rgi7.html">RGI-TOPO for RGI 7.0</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Related to OGGM</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../others/holoviz_intro.html">Small overview of HoloViz capability of data exploration</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">In (re-)construction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../construction/inversion_with_frontal_ablation.html">Ice thickness inversion with frontal ablation: a case study</a></li>
<li class="toctree-l1"><a class="reference internal" href="../construction/kcalving_parameterization.html">The Oerlemans &amp; Nick frontal ablation parameterization in OGGM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../construction/merging_glaciers.html">Merging glaciers for past climate simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../construction/area_length_filter.html">Filter the glacier length and area time series</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/OGGM/tutorials/master?urlpath=lab/tree/./notebooks/10minutes/numeric_solvers.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://hub.oggm.org/hub/user-redirect/git-pull?repo=https%3A//github.com/OGGM/tutorials&urlpath=lab/tree/tutorials/./notebooks/10minutes/numeric_solvers.ipynb&branch=master" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onJupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/OGGM/tutorials" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/OGGM/tutorials/edit/master/./notebooks/10minutes/numeric_solvers.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/OGGM/tutorials/issues/new?title=Issue%20on%20page%20%2Fnotebooks/10minutes/numeric_solvers.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/10minutes/numeric_solvers.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>10 minutes to… understand difference between ice dynamic models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">10 minutes to… understand difference between ice dynamic models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#flux-based-model-is-more-flexible-but-unstable">Flux-Based model is more flexible, but unstable</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-implicit-model-is-faster-and-more-stable-but-less-flexible">Semi-Implicit model is faster and more stable, but less flexible</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#have-5-minutes-more-the-bed-shape-of-the-downstream-line">Have 5 minutes more? The bed shape of the downstream line</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-next">What’s next?</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="minutes-to-understand-difference-between-ice-dynamic-models">
<h1>10 minutes to… understand difference between ice dynamic models<a class="headerlink" href="#minutes-to-understand-difference-between-ice-dynamic-models" title="Permalink to this heading">#</a></h1>
<p>In version 1.6, OGGM changed the default numeric solver to the <strong>Semi-Implicit</strong> model. In this notebook, we explore the main differences compared to the old default, the <strong>Flux-Based</strong> model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">oggm</span> <span class="kn">import</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">graphics</span><span class="p">,</span> <span class="n">tasks</span>
<span class="kn">from</span> <span class="nn">oggm.core.flowline</span> <span class="kn">import</span> <span class="n">FluxBasedModel</span><span class="p">,</span> <span class="n">SemiImplicitModel</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize OGGM and set up the default run parameters</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">logging_level</span><span class="o">=</span><span class="s1">&#39;WARNING&#39;</span><span class="p">)</span>

<span class="c1"># Define our test glacier (Baltoro)</span>
<span class="n">rgi_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RGI60-14.06794&#39;</span><span class="p">]</span>

<span class="c1"># load elevation band representation</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s1">&#39;working_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(</span><span class="s1">&#39;OGGM_dynamic_solvers_elevation_bands&#39;</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">base_url_eb</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L3-L5_files/2023.1/elev_bands/W5E5/&#39;</span>
<span class="n">gdir_eb</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgi_ids</span><span class="p">,</span> <span class="n">from_prepro_level</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">prepro_base_url</span><span class="o">=</span><span class="n">base_url_eb</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># load centerline representation</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PATHS</span><span class="p">[</span><span class="s1">&#39;working_dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">(</span><span class="s1">&#39;OGGM_dynamic_solvers_centerliens&#39;</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">base_url_cl</span> <span class="o">=</span> <span class="s1">&#39;https://cluster.klima.uni-bremen.de/~oggm/gdirs/oggm_v1.6/L3-L5_files/2023.1/centerlines/W5E5/&#39;</span>
<span class="n">gdir_cl</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">init_glacier_directories</span><span class="p">(</span><span class="n">rgi_ids</span><span class="p">,</span> <span class="n">from_prepro_level</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">prepro_base_url</span><span class="o">=</span><span class="n">base_url_cl</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-08-25 13:12:25: oggm.cfg: Reading default parameters from the OGGM `params.cfg` configuration file.
2023-08-25 13:12:25: oggm.cfg: Multiprocessing switched OFF according to the parameter file.
2023-08-25 13:12:25: oggm.cfg: Multiprocessing: using all available processors (N=2)
2023-08-25 13:12:26: oggm.workflow: init_glacier_directories from prepro level 3 on 1 glaciers.
2023-08-25 13:12:26: oggm.workflow: Execute entity tasks [gdir_from_prepro] on 1 glaciers
2023-08-25 13:12:35: oggm.workflow: init_glacier_directories from prepro level 3 on 1 glaciers.
2023-08-25 13:12:35: oggm.workflow: Execute entity tasks [gdir_from_prepro] on 1 glaciers
</pre></div>
</div>
</div>
</div>
<section id="flux-based-model-is-more-flexible-but-unstable">
<h2>Flux-Based model is more flexible, but unstable<a class="headerlink" href="#flux-based-model-is-more-flexible-but-unstable" title="Permalink to this heading">#</a></h2>
<p>The big advantage of the Flux-Based model is that it works for all flowline representations (multiple flowlines and different bed shapes). See also the tutorial <a class="reference internal" href="elevation_bands_vs_centerlines.html"><span class="doc std std-doc">“elevation band” and “centerline” flowlines</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run Flux-Based with centerlines</span>
<span class="n">tasks</span><span class="o">.</span><span class="n">run_random_climate</span><span class="p">(</span><span class="n">gdir_cl</span><span class="p">,</span>
                         <span class="n">evolution_model</span><span class="o">=</span><span class="n">FluxBasedModel</span><span class="p">,</span>
                         <span class="n">nyears</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                         <span class="n">y0</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                         <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">store_fl_diagnostics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">output_filesuffix</span><span class="o">=</span><span class="s1">&#39;_flux_based&#39;</span><span class="p">)</span>

<span class="c1"># plot result</span>
<span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">gdir_cl</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">(</span><span class="s1">&#39;model_diagnostics&#39;</span><span class="p">,</span> <span class="n">filesuffix</span><span class="o">=</span><span class="s1">&#39;_flux_based&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">ds_trap</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">ds_trap</span><span class="o">.</span><span class="n">volume_m3</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e10d9ca98660f00f1f9e669e1a43c3205610f616c50801da0ef014e96c281f72.png" src="../../_images/e10d9ca98660f00f1f9e669e1a43c3205610f616c50801da0ef014e96c281f72.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run Flux-Based with elevation bands</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>  <span class="c1"># time it for later comparision</span>
<span class="n">tasks</span><span class="o">.</span><span class="n">run_random_climate</span><span class="p">(</span><span class="n">gdir_eb</span><span class="p">,</span>
                         <span class="n">evolution_model</span><span class="o">=</span><span class="n">FluxBasedModel</span><span class="p">,</span>
                         <span class="n">nyears</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                         <span class="n">y0</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                         <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">store_fl_diagnostics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">output_filesuffix</span><span class="o">=</span><span class="s1">&#39;_flux_based&#39;</span><span class="p">)</span>
<span class="n">flux_based_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># plot result</span>
<span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">gdir_eb</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">(</span><span class="s1">&#39;model_diagnostics&#39;</span><span class="p">,</span> <span class="n">filesuffix</span><span class="o">=</span><span class="s1">&#39;_flux_based&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">ds_flux_eb</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">ds_flux_eb</span><span class="o">.</span><span class="n">volume_m3</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/bcec79a88bdf7e5298b6604c3b8ff9b876ff154332b9ac9b7e264f0b81dc5d92.png" src="../../_images/bcec79a88bdf7e5298b6604c3b8ff9b876ff154332b9ac9b7e264f0b81dc5d92.png" />
</div>
</div>
<p>Whereas the Semi-Impicit model only works for single trapezoidal flowlines (elevation bands).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run Semi-Implicit with centerlines raise an Error</span>
<span class="n">tasks</span><span class="o">.</span><span class="n">run_random_climate</span><span class="p">(</span><span class="n">gdir_cl</span><span class="p">,</span>
                         <span class="n">evolution_model</span><span class="o">=</span><span class="n">SemiImplicitModel</span><span class="p">,</span>
                         <span class="n">y0</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                         <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">store_fl_diagnostics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">output_filesuffix</span><span class="o">=</span><span class="s1">&#39;_semi_implicit&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-08-25 13:16:11: oggm.core.flowline: ValueError occurred during task flowline_model_run_semi_implicit on RGI60-14.06794: Implicit model does not work with tributaries.
2023-08-25 13:16:11: oggm.core.flowline: ValueError occurred during task run_random_climate_semi_implicit on RGI60-14.06794: Implicit model does not work with tributaries.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># run Semi-Implicit with centerlines raise an Error</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">tasks</span><span class="o">.</span><span class="n">run_random_climate</span><span class="p">(</span><span class="n">gdir_cl</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                          <span class="n">evolution_model</span><span class="o">=</span><span class="n">SemiImplicitModel</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>                          <span class="n">y0</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>                          <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>                          <span class="n">store_fl_diagnostics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>                          <span class="n">output_filesuffix</span><span class="o">=</span><span class="s1">&#39;_semi_implicit&#39;</span><span class="p">)</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.12/lib/python3.10/site-packages/oggm/utils/_workflow.py:492,</span> in <span class="ni">entity_task.__call__.&lt;locals&gt;._entity_task</span><span class="nt">(gdir, reset, print_log, return_value, continue_on_error, add_to_log_file, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">490</span>     <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;task_timeout&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">491</span> <span class="n">ex_t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">492</span> <span class="n">out</span> <span class="o">=</span> <span class="n">task_func</span><span class="p">(</span><span class="n">gdir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">493</span> <span class="n">ex_t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ex_t</span>
<span class="g g-Whitespace">    </span><span class="mi">494</span> <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;task_timeout&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.12/lib/python3.10/site-packages/oggm/core/flowline.py:3417,</span> in <span class="ni">run_random_climate</span><span class="nt">(gdir, nyears, y0, halfsize, ys, ye, bias, seed, temperature_bias, precipitation_factor, store_monthly_step, store_model_geometry, store_fl_diagnostics, mb_model_class, climate_filename, climate_input_filesuffix, output_filesuffix, init_model_fls, init_model_filesuffix, init_model_yr, zero_initial_glacier, unique_samples, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">3414</span> <span class="k">if</span> <span class="n">ye</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3415</span>     <span class="n">ye</span> <span class="o">=</span> <span class="n">ys</span> <span class="o">+</span> <span class="n">nyears</span>
<span class="ne">-&gt; </span><span class="mi">3417</span> <span class="k">return</span> <span class="n">flowline_model_run</span><span class="p">(</span><span class="n">gdir</span><span class="p">,</span> <span class="n">output_filesuffix</span><span class="o">=</span><span class="n">output_filesuffix</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3418</span>                           <span class="n">mb_model</span><span class="o">=</span><span class="n">mb_model</span><span class="p">,</span> <span class="n">ys</span><span class="o">=</span><span class="n">ys</span><span class="p">,</span> <span class="n">ye</span><span class="o">=</span><span class="n">ye</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3419</span>                           <span class="n">store_monthly_step</span><span class="o">=</span><span class="n">store_monthly_step</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3420</span>                           <span class="n">store_model_geometry</span><span class="o">=</span><span class="n">store_model_geometry</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3421</span>                           <span class="n">store_fl_diagnostics</span><span class="o">=</span><span class="n">store_fl_diagnostics</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3422</span>                           <span class="n">init_model_filesuffix</span><span class="o">=</span><span class="n">init_model_filesuffix</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3423</span>                           <span class="n">init_model_yr</span><span class="o">=</span><span class="n">init_model_yr</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3424</span>                           <span class="n">init_model_fls</span><span class="o">=</span><span class="n">init_model_fls</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3425</span>                           <span class="n">zero_initial_glacier</span><span class="o">=</span><span class="n">zero_initial_glacier</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3426</span>                           <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.12/lib/python3.10/site-packages/oggm/utils/_workflow.py:492,</span> in <span class="ni">entity_task.__call__.&lt;locals&gt;._entity_task</span><span class="nt">(gdir, reset, print_log, return_value, continue_on_error, add_to_log_file, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">490</span>     <span class="n">signal</span><span class="o">.</span><span class="n">alarm</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;task_timeout&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">491</span> <span class="n">ex_t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="ne">--&gt; </span><span class="mi">492</span> <span class="n">out</span> <span class="o">=</span> <span class="n">task_func</span><span class="p">(</span><span class="n">gdir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">493</span> <span class="n">ex_t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ex_t</span>
<span class="g g-Whitespace">    </span><span class="mi">494</span> <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;task_timeout&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.12/lib/python3.10/site-packages/oggm/core/flowline.py:3284,</span> in <span class="ni">flowline_model_run</span><span class="nt">(gdir, output_filesuffix, mb_model, ys, ye, zero_initial_glacier, init_model_fls, store_monthly_step, fixed_geometry_spinup_yr, store_model_geometry, store_fl_diagnostics, water_level, evolution_model, stop_criterion, init_model_filesuffix, init_model_yr, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">3276</span>     <span class="k">if</span> <span class="n">water_level</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">3277</span>         <span class="k">raise</span> <span class="n">InvalidWorkflowError</span><span class="p">(</span><span class="s1">&#39;This tidewater glacier seems to not &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">3278</span>                                    <span class="s1">&#39;have been inverted with the &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">3279</span>                                    <span class="s1">&#39;`find_inversion_calving` task. Set &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">3280</span>                                    <span class="s2">&quot;PARAMS[&#39;use_kcalving_for_run&#39;] to &quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">3281</span>                                    <span class="s1">&#39;`False` or set `water_level` &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">3282</span>                                    <span class="s1">&#39;to prevent this error.&#39;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">3284</span> <span class="n">model</span> <span class="o">=</span> <span class="n">evolution_model</span><span class="p">(</span><span class="n">fls</span><span class="p">,</span> <span class="n">mb_model</span><span class="o">=</span><span class="n">mb_model</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="n">ys</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3285</span>                        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3286</span>                        <span class="n">is_tidewater</span><span class="o">=</span><span class="n">gdir</span><span class="o">.</span><span class="n">is_tidewater</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3287</span>                        <span class="n">is_lake_terminating</span><span class="o">=</span><span class="n">gdir</span><span class="o">.</span><span class="n">is_lake_terminating</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3288</span>                        <span class="n">water_level</span><span class="o">=</span><span class="n">water_level</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">3289</span>                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3291</span> <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
<span class="g g-Whitespace">   </span><span class="mi">3292</span>     <span class="c1"># For operational runs we ignore the warnings</span>
<span class="g g-Whitespace">   </span><span class="mi">3293</span>     <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>

<span class="nn">File /usr/local/pyenv/versions/3.10.12/lib/python3.10/site-packages/oggm/core/flowline.py:2202,</span> in <span class="ni">SemiImplicitModel.__init__</span><span class="nt">(self, flowlines, mb_model, y0, glen_a, fs, inplace, fixed_dt, cfl_number, min_dt, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2197</span> <span class="nb">super</span><span class="p">(</span><span class="n">SemiImplicitModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">flowlines</span><span class="p">,</span> <span class="n">mb_model</span><span class="o">=</span><span class="n">mb_model</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2198</span>                                         <span class="n">y0</span><span class="o">=</span><span class="n">y0</span><span class="p">,</span> <span class="n">glen_a</span><span class="o">=</span><span class="n">glen_a</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">2199</span>                                         <span class="n">inplace</span><span class="o">=</span><span class="n">inplace</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2201</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2202</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Implicit model does not work with &#39;</span>
<span class="g g-Whitespace">   </span><span class="mi">2203</span>                      <span class="s1">&#39;tributaries.&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2205</span> <span class="c1"># convert pure RectangularBedFlowline to TrapezoidalBedFlowline with</span>
<span class="g g-Whitespace">   </span><span class="mi">2206</span> <span class="c1"># lambda = 0</span>
<span class="g g-Whitespace">   </span><span class="mi">2207</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">RectangularBedFlowline</span><span class="p">):</span>

<span class="ne">ValueError</span>: Implicit model does not work with tributaries.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># run Semi-Implicit with elevation bands</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>  <span class="c1"># time it for later comparision</span>
<span class="n">tasks</span><span class="o">.</span><span class="n">run_random_climate</span><span class="p">(</span><span class="n">gdir_eb</span><span class="p">,</span>
                         <span class="n">evolution_model</span><span class="o">=</span><span class="n">SemiImplicitModel</span><span class="p">,</span>
                         <span class="n">nyears</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                         <span class="n">y0</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
                         <span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                         <span class="n">store_fl_diagnostics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">output_filesuffix</span><span class="o">=</span><span class="s1">&#39;_semi_implicit&#39;</span><span class="p">)</span>
<span class="n">semi_implicit_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="c1"># plot result</span>
<span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">gdir_eb</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">(</span><span class="s1">&#39;model_diagnostics&#39;</span><span class="p">,</span> <span class="n">filesuffix</span><span class="o">=</span><span class="s1">&#39;_semi_implicit&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">ds_impl_eb</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="n">ds_impl_eb</span><span class="o">.</span><span class="n">volume_m3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SemiImplicitModel&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ds_flux_eb</span><span class="o">.</span><span class="n">volume_m3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;FluxBasedModel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/2e1a380541fa39b5455d809d1d86194fa1320eafabef49524ad9c1ae921925f5.png" src="../../_images/2e1a380541fa39b5455d809d1d86194fa1320eafabef49524ad9c1ae921925f5.png" />
</div>
</div>
<p>You see that for the elevation band flowlines, both produce similar results. The differences arise from numeric instabilities in the Flux-Based model (see next paragraph). You can redo the experiment with a glacier where these instabilities are not that severe (e.g. RGI60-11.00897 Hintereisferner) and you will see both models produce the same result.</p>
</section>
<section id="semi-implicit-model-is-faster-and-more-stable-but-less-flexible">
<h2>Semi-Implicit model is faster and more stable, but less flexible<a class="headerlink" href="#semi-implicit-model-is-faster-and-more-stable-but-less-flexible" title="Permalink to this heading">#</a></h2>
<p>Even the Semi-Implicit model is not as flexible as the Flux-Based one, we see it is faster when comparing the computing time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Semi-Implicit time needed: </span><span class="si">{</span><span class="n">semi_implicit_time</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> s&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Flux-Based time needed: </span><span class="si">{</span><span class="n">flux_based_time</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> s&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Semi-Implicit time needed: 1.9 s
Flux-Based time needed: 3.4 s
</pre></div>
</div>
</div>
</div>
<p>For a single glacier, this speed-up is probably not that important, but when thinking about regional to global simulations it can save you a lot of time.</p>
<p>One reason for the speed-up is that the Semi-Implicit model is numerically more stable and can take larger time steps without producing instabilities:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># open flowline diagnostics</span>
<span class="n">f_impl</span> <span class="o">=</span> <span class="n">gdir_eb</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">(</span><span class="s1">&#39;fl_diagnostics&#39;</span><span class="p">,</span> <span class="n">filesuffix</span><span class="o">=</span><span class="s1">&#39;_semi_implicit&#39;</span><span class="p">)</span>
<span class="n">f_flux</span> <span class="o">=</span> <span class="n">gdir_eb</span><span class="o">.</span><span class="n">get_filepath</span><span class="p">(</span><span class="s1">&#39;fl_diagnostics&#39;</span><span class="p">,</span> <span class="n">filesuffix</span><span class="o">=</span><span class="s1">&#39;_flux_based&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f_impl</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;fl_0&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">ds_fl_impl</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">f_flux</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;fl_0&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">ds_fl_flux</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    
<span class="c1"># compare velocities along flowline</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">ds_fl_impl</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">ice_velocity_myr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;SemiImplicitModel&#39;</span><span class="p">)</span>
<span class="n">ds_fl_flux</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">ice_velocity_myr</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;FluxBasedModel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/618fa4724a06ac048ef10404705d065e486e405b261cb8ce88e3c97d9e631d3c.png" src="../../_images/618fa4724a06ac048ef10404705d065e486e405b261cb8ce88e3c97d9e631d3c.png" />
</div>
</div>
<p>The instabilities are visible for the FluxBasedModel at around 30 km distance along the flowline. They can lead to very large velocities which reduce the maximum possible step size due to the cfl-criterion (see also in the <a class="reference external" href="https://docs.oggm.org/en/latest/faq.html#ice-velocities-in-oggm-are-sometimes-noisy-or-unrealistic-how-so">documentation</a>).</p>
<p>The computing speed up and, even more, the increased stability are the reasons why we switched to the SemiImplicitModel in OGGM v1.6.</p>
<p>However, if you want to set the FluxBasedModel as the default you can do so with:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;evolution_model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FluxBased&#39;</span>  <span class="c1"># default is &#39;SemiImplicit&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-08-25 13:16:15: oggm.cfg: PARAMS[&#39;evolution_model&#39;] changed from `SemiImplicit` to `FluxBased`.
</pre></div>
</div>
</div>
</div>
</section>
<section id="have-5-minutes-more-the-bed-shape-of-the-downstream-line">
<h2>Have 5 minutes more? The bed shape of the downstream line<a class="headerlink" href="#have-5-minutes-more-the-bed-shape-of-the-downstream-line" title="Permalink to this heading">#</a></h2>
<p>This paragraph deals with the downstream line, the initially ice-free part of the glacier. You can see it below as the red line connecting the end of the outline with the left border of the figure:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_centerlines</span><span class="p">(</span><span class="n">gdir_cl</span><span class="p">,</span>
                          <span class="n">use_flowlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">add_downstream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/32f311dbbbbd2669f0ac608302272a53b3aa05d2a0ecfcf163aa2eb328d53730.png" src="../../_images/32f311dbbbbd2669f0ac608302272a53b3aa05d2a0ecfcf163aa2eb328d53730.png" />
</div>
</div>
<p>In OGGM before v1.6, with the FluxBasedModel, the shape of this downstream line was defined by fitting a parabola to the valley walls. However, for the SemiImplicitModel we had to change the shape to a trapezoidal, even a parabola approximates a mountain valley arguably better. We checked the influence of this change on advancing glaciers and found negligibly small differences in the volume on a regional scale. There might be some differences in the area.</p>
<p>By default, we use a trapezoidal bed shape for the downstream line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fl_trap</span> <span class="o">=</span> <span class="n">gdir_eb</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;model_flowlines&#39;</span><span class="p">)</span>
<span class="n">fl_trap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">is_trapezoid</span><span class="p">[</span><span class="n">fl_trap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">thick</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True,  True,  True,  True,  True])
</pre></div>
</div>
</div>
</div>
<p>But if for any reason you decided to use the FluxBasedModel you also can switch back to a parabolic downstream line using <code class="docutils literal notranslate"><span class="pre">cfg.PARAMS['downstream_line_shape']</span> <span class="pre">=</span> <span class="pre">'parabola'</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># change the downstream line shape</span>
<span class="n">cfg</span><span class="o">.</span><span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;downstream_line_shape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;parabola&#39;</span>  <span class="c1"># default is &#39;trapezoidal&#39;</span>

<span class="c1"># IMPORTANT: need to call init_present_time_glacier to take effect</span>
<span class="n">tasks</span><span class="o">.</span><span class="n">init_present_time_glacier</span><span class="p">(</span><span class="n">gdir_eb</span><span class="p">)</span>

<span class="n">fl_trap</span> <span class="o">=</span> <span class="n">gdir_eb</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s1">&#39;model_flowlines&#39;</span><span class="p">)</span>
<span class="n">fl_trap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">is_trapezoid</span><span class="p">[</span><span class="n">fl_trap</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">thick</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2023-08-25 13:16:23: oggm.cfg: PARAMS[&#39;downstream_line_shape&#39;] changed from `trapezoidal` to `parabola`.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False, False])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="what-s-next">
<h1>What’s next?<a class="headerlink" href="#what-s-next" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>return to the <a class="reference external" href="https://docs.oggm.org">OGGM documentation</a></p></li>
<li><p>back to the <a class="reference internal" href="../welcome.html"><span class="doc std std-doc">table of contents</span></a></p></li>
</ul>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/10minutes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">10 minutes to… understand difference between ice dynamic models</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#flux-based-model-is-more-flexible-but-unstable">Flux-Based model is more flexible, but unstable</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-implicit-model-is-faster-and-more-stable-but-less-flexible">Semi-Implicit model is faster and more stable, but less flexible</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#have-5-minutes-more-the-bed-shape-of-the-downstream-line">Have 5 minutes more? The bed shape of the downstream line</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#what-s-next">What’s next?</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By OGGM e.V. and OGGM Contributors
</p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
These notebooks are licensed under a <a href="https://github.com/OGGM/tutorials/blob/master/LICENSE.txt" target="_blank">BSD-3-Clause license</a>.
<br>
&copy; Copyright 2014-2021.
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>